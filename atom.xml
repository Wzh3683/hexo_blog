<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>WZH的博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wzh3683.github.io/hexo_blog/"/>
  <updated>2020-07-06T04:27:17.083Z</updated>
  <id>https://wzh3683.github.io/hexo_blog/</id>
  
  <author>
    <name>王增辉</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>&#39;在线客服系统-基于flask+vue+socket.io实现在线客服系统&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/28/%E5%9C%A8%E7%BA%BF%E5%AE%A2%E6%9C%8D%E7%B3%BB%E7%BB%9F-%E5%9F%BA%E4%BA%8Eflask-vue%E9%9B%86%E6%88%90%E9%A1%B9%E7%9B%AE/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/28/%E5%9C%A8%E7%BA%BF%E5%AE%A2%E6%9C%8D%E7%B3%BB%E7%BB%9F-%E5%9F%BA%E4%BA%8Eflask-vue%E9%9B%86%E6%88%90%E9%A1%B9%E7%9B%AE/</id>
    <published>2020-06-28T08:52:56.000Z</published>
    <updated>2020-07-06T04:27:17.083Z</updated>
    
    <content type="html"><![CDATA[<h3 id="socket-io介绍"><a href="#socket-io介绍" class="headerlink" title="socket.io介绍"></a>socket.io介绍</h3><p>Socket.IO 就是一个封装了 Websocket、基于 Node 的 JavaScript 框架，包含 client 的 JavaScript 和 server 的 Node（现在也支持python,go lang等语言）。其屏蔽了所有底层细节，让顶层调用非常简单，另外，Socket.IO 还有一个非常重要的好处。其不仅支持 WebSocket，还支持许多种轮询机制以及其他实时通信方式，并封装了通用的接口。这些方式包含 Adobe Flash Socket、Ajax 长轮询、Ajax multipart streaming 、持久 Iframe、JSONP 轮询等。<a id="more"></a>换句话说，当 Socket.IO 检测到当前环境不支持 WebSocket 时，能够自动地选择最佳的方式来实现网络的实时通信，这一点就比websocket要智能不少。</p><h3 id="后台服务搭建"><a href="#后台服务搭建" class="headerlink" title="后台服务搭建"></a>后台服务搭建</h3><p>结合python和flask需要的模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install flask</span><br><span class="line">pip install flask-cors</span><br><span class="line">pip install flask-socketio</span><br><span class="line">pip install Flask-SQLAlchemy</span><br></pre></td></tr></table></figure><p>本次模块对应版本号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flask                 1.1.1</span><br><span class="line">Flask-Cors            3.0.8</span><br><span class="line">Flask-SocketIO        4.3.0</span><br><span class="line">Flask-SQLAlchemy      2.4.1</span><br></pre></td></tr></table></figure><h3 id="flask的启动文件manage-py"><a href="#flask的启动文件manage-py" class="headerlink" title="flask的启动文件manage.py"></a>flask的启动文件manage.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request,jsonify</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"><span class="keyword">from</span> flask_socketio <span class="keyword">import</span> SocketIO,send,emit</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">CORS(app,cors_allowed_origins=<span class="string">"*"</span>)</span><br><span class="line"></span><br><span class="line">socketio = SocketIO(app,cors_allowed_origins=<span class="string">'*'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@socketio.on('message')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_message</span><span class="params">(message)</span>:</span></span><br><span class="line">    message = urllib.parse.unquote(message)</span><br><span class="line">    print(message)</span><br><span class="line">    send(message,broadcast=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on('connect', namespace='/chat')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_connect</span><span class="params">()</span>:</span></span><br><span class="line">    emit(<span class="string">'my response'</span>, &#123;<span class="string">'data'</span>: <span class="string">'Connected'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@socketio.on('disconnect', namespace='/chat')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_disconnect</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Client disconnected'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    socketio.run(app,debug=<span class="literal">True</span>,host=<span class="string">"0.0.0.0"</span>,port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>这里简单说一下需要注意的地方，实例化socketio对象的时候，要加上cors_allowed_origins来设置跨域，前后端分离项目让人伤脑筋的地方就是浏览器同源策略问题，而跨域最好由server端来单独配置，这样的好处是当多个前端项目同时共用一套微服务接口时，就不用每个前端项目都配置一次跨域了。</p><p>我们写了三个基于socketio的视图方法，connect和disconnect顾名思义，当clinet发起连接或者断开时我们可以及时捕获到，而message方法就是前后端进行消息通信的重要方法。</p><p>发送消息的时候方法加了一个broadcast参数，这是socket.io极具特色的功能，类似广播的效果，可以同时给不同链接的client发送消息，即可以用于聊天，也可以用来做消息推送。</p><p>最后需要注意的一点是，client发送消息时，最好用urlencode编码一下，这样可以解决中文乱码问题，而在server端，可以用urllib.parse.unquote()来进行解码操作。</p><h3 id="运行命令启动后端服务"><a href="#运行命令启动后端服务" class="headerlink" title="运行命令启动后端服务"></a>运行命令启动后端服务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py</span><br></pre></td></tr></table></figure><p><img src="/img/python/%E5%90%AF%E5%8A%A8flask%E5%91%BD%E4%BB%A4.png" alt="启动flask命令"><br>服务正常启动在5000端口上，就说明后端没有问题了。</p><h3 id="前端配置"><a href="#前端配置" class="headerlink" title="前端配置"></a>前端配置</h3><p>配置前端(client)，前端采用vue2.0框架来驱动，也需要安装socket.io模块<br>这里一定要指定版本号来安装，版本是2.1.0，因为该依赖的最新版在vue2.0项目中编译时会报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-socket.io@2.1.0</span><br></pre></td></tr></table></figure><p>在main.js中引用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueSocketio <span class="keyword">from</span> <span class="string">'vue-socket.io'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(VueSocketio,<span class="string">'http://127.0.0.1:5000'</span>);</span><br></pre></td></tr></table></figure><p>注意链接的url是后端服务的地址+端口，千万不要加其他url后缀或者命名空间</p><p>新建一个用户页面，user.vue来模拟用户链接</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"item in log_list"</span>&gt;</span></span><br><span class="line">    &#123;&#123;item&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"msg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"send"</span>&gt;</span>发送消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">  msg: <span class="string">""</span>,</span></span><br><span class="line">  log_list:[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="actionscript">  <span class="comment">//注册组件标签</span></span></span><br><span class="line">  components:&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  sockets:&#123;</span><br><span class="line"><span class="actionscript">    connect: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'socket 连接成功'</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    message: <span class="function"><span class="keyword">function</span><span class="params">(val)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">'返回:'</span>+val);</span></span><br><span class="line"><span class="actionscript"><span class="keyword">this</span>.log_list.push(val);</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="actionscript">  mounted:<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"> </span><br><span class="line">&#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">send()&#123;</span><br><span class="line"><span class="javascript">  <span class="keyword">this</span>.$socket.emit(<span class="string">'message'</span>,<span class="built_in">encodeURI</span>(<span class="string">"用户:"</span>+<span class="keyword">this</span>.msg));</span></span><br><span class="line">    &#125;,     </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">d<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动前端服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p>访问前端页面 <a href="http://localhost:8080/user" target="_blank" rel="noopener">http://localhost:8080/user</a> 可以看到服务成功链接</p><p>新建一个后台客服组件页面，item.vue用来模拟用户和客服在不同电脑进行聊天的场景</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"item in log_list"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">&#123;&#123;item&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"msg"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"send"</span>&gt;</span>发送消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">  msg: <span class="string">""</span>,</span></span><br><span class="line">  log_list:[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="actionscript">  <span class="comment">//注册组件标签</span></span></span><br><span class="line">  components:&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  sockets:&#123;</span><br><span class="line"><span class="actionscript">    connect: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'socket 连接成功'</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    message: <span class="function"><span class="keyword">function</span><span class="params">(val)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">'返回:'</span>+val);</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">this</span>.log_list.push(val);</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="actionscript">  mounted:<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">send()&#123;</span><br><span class="line"><span class="javascript">  <span class="keyword">this</span>.$socket.emit(<span class="string">'message'</span>,<span class="built_in">encodeURI</span>(<span class="string">"客服:"</span>+<span class="keyword">this</span>.msg));</span></span><br><span class="line">    &#125;,    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="最后效果"><a href="#最后效果" class="headerlink" title="最后效果"></a>最后效果</h3><p><img src="/img/python/%E5%AE%A2%E6%9C%8D%E7%B3%BB%E7%BB%9F1.png" alt="效果1"><br><img src="/img/python/%E5%AE%A2%E6%9C%8D%E7%B3%BB%E7%BB%9F2.png" alt="效果2"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;socket-io介绍&quot;&gt;&lt;a href=&quot;#socket-io介绍&quot; class=&quot;headerlink&quot; title=&quot;socket.io介绍&quot;&gt;&lt;/a&gt;socket.io介绍&lt;/h3&gt;&lt;p&gt;Socket.IO 就是一个封装了 Websocket、基于 Node 的 JavaScript 框架，包含 client 的 JavaScript 和 server 的 Node（现在也支持python,go lang等语言）。其屏蔽了所有底层细节，让顶层调用非常简单，另外，Socket.IO 还有一个非常重要的好处。其不仅支持 WebSocket，还支持许多种轮询机制以及其他实时通信方式，并封装了通用的接口。这些方式包含 Adobe Flash Socket、Ajax 长轮询、Ajax multipart streaming 、持久 Iframe、JSONP 轮询等。
    
    </summary>
    
    
      <category term="flask" scheme="https://wzh3683.github.io/hexo_blog/categories/flask/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="flask" scheme="https://wzh3683.github.io/hexo_blog/tags/flask/"/>
    
      <category term="websocket" scheme="https://wzh3683.github.io/hexo_blog/tags/websocket/"/>
    
  </entry>
  
  <entry>
    <title>&#39;flask第二弹——cookie和session&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/26/flask%E7%AC%AC%E4%BA%8C%E5%BC%B9%E2%80%94%E2%80%94cookie%E5%92%8Csession/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/26/flask%E7%AC%AC%E4%BA%8C%E5%BC%B9%E2%80%94%E2%80%94cookie%E5%92%8Csession/</id>
    <published>2020-06-26T09:56:48.000Z</published>
    <updated>2020-06-26T10:01:31.148Z</updated>
    
    <content type="html"><![CDATA[<p>上一章讲了<a href="">flask的入门</a>,这一章说一下flask中的cookie和session</p><h3 id="设置cookie和获取cookie"><a href="#设置cookie和获取cookie" class="headerlink" title="设置cookie和获取cookie"></a>设置cookie和获取cookie</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导包</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,make_response,request</span><br><span class="line"></span><br><span class="line"><span class="comment">#建立flask对象</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从配置文件来加载配置</span></span><br><span class="line">app.config.from_pyfile(<span class="string">'config.ini'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用flask路由器，指定网址和控制器,首页</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'hello python'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用make_response库设置cookie</span></span><br><span class="line"><span class="meta">@app.route('/set_cookie')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_cookie</span><span class="params">()</span>:</span></span><br><span class="line">resp = make_response(<span class="string">'存储cookie'</span>)</span><br><span class="line">    <span class="comment">#使用set_cookie来存储key-value形式的数据</span></span><br><span class="line">resp.set_cookie(<span class="string">'username'</span>,<span class="string">'wzh'</span>)</span><br><span class="line"><span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用request库获取cookie</span></span><br><span class="line"><span class="meta">@app.route('/get_cookie')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cookie</span><span class="params">()</span>:</span></span><br><span class="line">resp = make_response(<span class="string">'获取cookie'</span>)</span><br><span class="line">    <span class="comment">#获取cookie需要使用request库</span></span><br><span class="line">    resp = request.cookies.get(<span class="string">'username'</span>)</span><br><span class="line"><span class="comment"># resp = request.cookies['username']</span></span><br><span class="line"><span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;上一章讲了&lt;a href=&quot;&quot;&gt;flask的入门&lt;/a&gt;,这一章说一下flask中的cookie和session&lt;/p&gt;
&lt;h3 id=&quot;设置cookie和获取cookie&quot;&gt;&lt;a href=&quot;#设置cookie和获取cookie&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
    
      <category term="flask" scheme="https://wzh3683.github.io/hexo_blog/categories/flask/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="flask" scheme="https://wzh3683.github.io/hexo_blog/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>&#39;flask第一弹——flask安装及入门&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/26/flask%E7%AC%AC%E4%B8%80%E5%BC%B9%E2%80%94%E2%80%94flask%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%A5%E9%97%A8/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/26/flask%E7%AC%AC%E4%B8%80%E5%BC%B9%E2%80%94%E2%80%94flask%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%A5%E9%97%A8/</id>
    <published>2020-06-26T02:36:10.000Z</published>
    <updated>2020-06-26T09:55:37.489Z</updated>
    
    <content type="html"><![CDATA[<p>Flask是一个使用 Python 编写的轻量级 Web 应用框架。其 WSGI 工具箱采用 Werkzeug ，模板引擎则使用 Jinja2 。Flask使用 BSD 授权。</p><p>Flask是一个轻量级的可定制框架，使用Python语言编写，较其他同类型框架更为灵活、轻便、安全且容易上手。它可以很好地结合MVC模式进行开发，开发人员分工合作，小型团队在短时间内就可以完成功能丰富的中小型网站或Web服务的实现。另外，Flask还有很强的定制性，用户可以根据自己的需求来添加相应的功能，在保持核心功能简单的同时实现功能的丰富与扩展，其强大的插件库可以让用户实现个性化的网站定制，开发出功能强大的网站。</p><a id="more"></a><h3 id="下载安装flask依赖"><a href="#下载安装flask依赖" class="headerlink" title="下载安装flask依赖"></a>下载安装flask依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install Flask</span><br><span class="line">pip install Flask-Cors</span><br><span class="line">pip install Flask-Migrate</span><br><span class="line">pip install Flask-SQLAlchemy</span><br></pre></td></tr></table></figure><h3 id="flask的入门使用"><a href="#flask的入门使用" class="headerlink" title="flask的入门使用"></a>flask的入门使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导包</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,redirect,url_for,jsonify</span><br><span class="line"></span><br><span class="line"><span class="comment">#建立flask对象</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用flask路由器route，指定网址和控制器</span></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'hello python'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用程序入口,将flask应用启动，port参数用来调整端口，默认端口是5000</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">app.run(debug=<span class="literal">True</span>)  <span class="comment">#debug=True测试</span></span><br></pre></td></tr></table></figure><h3 id="flask的路由传参"><a href="#flask的路由传参" class="headerlink" title="flask的路由传参"></a>flask的路由传参</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/hello/&lt;id&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(id)</span>:</span></span><br><span class="line">print(id)</span><br><span class="line"><span class="keyword">return</span> <span class="string">'123 世界 参数%s'</span>%id</span><br></pre></td></tr></table></figure><h3 id="flask的跳转"><a href="#flask的跳转" class="headerlink" title="flask的跳转"></a>flask的跳转</h3><p>flask有两种跳转方式，一种是根据网址跳转，一种是根据函数名跳转</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用重定向模块跳转</span></span><br><span class="line"><span class="meta">@app.route('/re')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re</span><span class="params">()</span>:</span></span><br><span class="line"><span class="comment">#redirect根据网址进行跳转</span></span><br><span class="line"><span class="keyword">return</span> redirect(<span class="string">'http://okwzh.cn'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用url_for来实现简单的站内跳转，参数是指定路由函数名</span></span><br><span class="line"><span class="meta">@app.route('/url')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url</span><span class="params">()</span>:</span></span><br><span class="line"><span class="comment">#redirect根据函数名跳转</span></span><br><span class="line"><span class="keyword">return</span> redirect(url_for(<span class="string">'re'</span>))</span><br><span class="line">    <span class="comment">#跳转加参数</span></span><br><span class="line">    <span class="comment">#return redirect(url_for('hello',id=1))</span></span><br></pre></td></tr></table></figure><h3 id="flask返回json类型"><a href="#flask返回json类型" class="headerlink" title="flask返回json类型"></a>flask返回json类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#返回json数据</span></span><br><span class="line"><span class="meta">@app.route('/json')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_json</span><span class="params">()</span>:</span></span><br><span class="line">json_dict = &#123;</span><br><span class="line"><span class="string">'id'</span>:<span class="number">10</span>,</span><br><span class="line"><span class="string">'title'</span>:<span class="string">'王增辉'</span>,</span><br><span class="line"><span class="string">'content'</span>:<span class="string">'这是json类型'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> jsonify(json_dict)</span><br><span class="line"></span><br><span class="line"><span class="comment">#解决中文乱码问题，让中文正常显示</span></span><br><span class="line"><span class="comment">#访问之后我们发现返回的是json类型存在编码问题,于是我们在配置上添加</span></span><br><span class="line">app.config[<span class="string">'JSON_AS_ASCII'</span>] = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="flask的钩子方法及使用"><a href="#flask的钩子方法及使用" class="headerlink" title="flask的钩子方法及使用"></a>flask的钩子方法及使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一次请求前</span></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brfore_first_request</span><span class="params">()</span>:</span></span><br><span class="line">print(<span class="string">'这是第一次请求之前调用的方法'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#每次请求前</span></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before_request</span><span class="params">()</span>:</span></span><br><span class="line">print(<span class="string">'每次请求之前调用的方法'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#每次请求之后</span></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="comment">#必须传响应参数，将响应内容返回</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after_request</span><span class="params">(response)</span>:</span></span><br><span class="line">print(<span class="string">'每次请求之后调用的方法'</span>)</span><br><span class="line"><span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在请求之后，调用服务器出现的错误信息</span></span><br><span class="line"><span class="meta">@app.teardown_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">teardown_request</span><span class="params">(e)</span>:</span></span><br><span class="line">print(<span class="string">'服务器出现的错误是%s'</span>%str(e))</span><br></pre></td></tr></table></figure><h3 id="flask添加配置文件的三种方式"><a href="#flask添加配置文件的三种方式" class="headerlink" title="flask添加配置文件的三种方式"></a>flask添加配置文件的三种方式</h3><p>1.从配置文件里加载配置<br>创建一个config.ini的文件，里面存放配置信息<br>app.config.from_pyfile(‘config.ini’)</p><p>2.从环境变量中加载配置<br>app.config.from_envvar(‘app_config’)</p><p>3.从配置对象来加载配置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建立一个配置类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>:</span></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line">JSON_AS_ASCII = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">app.config.from_object(Config)</span><br></pre></td></tr></table></figure><h3 id="flask统一对状态码捕获异常"><a href="#flask统一对状态码捕获异常" class="headerlink" title="flask统一对状态码捕获异常"></a>flask统一对状态码捕获异常</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#flask统一对状态码捕获异常</span></span><br><span class="line"><span class="meta">@app.errorhandler(405)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_error</span><span class="params">(e)</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'这个接口不能被get获取到，只能被post获取'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_error2</span><span class="params">(e)</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'网页不存在'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flask是一个使用 Python 编写的轻量级 Web 应用框架。其 WSGI 工具箱采用 Werkzeug ，模板引擎则使用 Jinja2 。Flask使用 BSD 授权。&lt;/p&gt;
&lt;p&gt;Flask是一个轻量级的可定制框架，使用Python语言编写，较其他同类型框架更为灵活、轻便、安全且容易上手。它可以很好地结合MVC模式进行开发，开发人员分工合作，小型团队在短时间内就可以完成功能丰富的中小型网站或Web服务的实现。另外，Flask还有很强的定制性，用户可以根据自己的需求来添加相应的功能，在保持核心功能简单的同时实现功能的丰富与扩展，其强大的插件库可以让用户实现个性化的网站定制，开发出功能强大的网站。&lt;/p&gt;
    
    </summary>
    
    
      <category term="flask" scheme="https://wzh3683.github.io/hexo_blog/categories/flask/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="flask" scheme="https://wzh3683.github.io/hexo_blog/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>&#39;python高阶函数&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/22/python%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/22/python%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/</id>
    <published>2020-06-22T01:25:12.000Z</published>
    <updated>2020-06-22T03:01:54.950Z</updated>
    
    <content type="html"><![CDATA[<h3 id="什么是高阶函数？"><a href="#什么是高阶函数？" class="headerlink" title="什么是高阶函数？"></a>什么是高阶函数？</h3><p>高阶函数：一个函数可以作为参数传给另外一个函数，或者一个函数的返回值为另外一个函数（若返回值为该函数本身，则为递归），满足其一则为高阶函数。</p><a id="more"></a><span class='p red'>函数作为参数</span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">print(<span class="string">'这是第一个函数'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_two</span><span class="params">(func)</span>:</span></span><br><span class="line">func()</span><br><span class="line">print(<span class="string">'这是第二个函数'</span>)</span><br><span class="line"></span><br><span class="line">func_two(func)</span><br><span class="line"></span><br><span class="line"><span class="comment">#这是第一个函数</span></span><br><span class="line"><span class="comment">#这是第二个函数</span></span><br></pre></td></tr></table></figure><span class='p red'>函数作为另一个函数的返回值</span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'这是第一个函数'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_two</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'这是第二个函数'</span>)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line">f = func_two(func)</span><br><span class="line">f()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是第二个函数</span></span><br><span class="line"><span class="comment"># 这是第一个函数</span></span><br></pre></td></tr></table></figure><h3 id="lambda表达式，匿名函数"><a href="#lambda表达式，匿名函数" class="headerlink" title="lambda表达式，匿名函数"></a>lambda表达式，匿名函数</h3><p>lambda是一个表达式，他的整体架构比def函数简单得多。所以lambda只能封装有限的逻辑。</p><span class='p red'>lambda表达式的作用</span><p>lambda函数起到了函数速写的作用。</p><span class='p red'>lambda表达式的格式语法</span><p>由于lambda表达式返回的是函数对象(这里构建的是一个函数对象)，所以我们需要使用一个变量去接受它。<br>格式：lambda的一般形式是关键字lambda后面跟一个或多个参数，紧跟一个冒号，之后是一个表达式。</p><figure class="highlight python"><figcaption><span>一个参数</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = <span class="keyword">lambda</span> args : args + <span class="number">1</span></span><br><span class="line">print(res(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 2</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>多个参数</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = <span class="keyword">lambda</span> args1,args2 : args1 * args2</span><br><span class="line">print(res(<span class="number">6</span>,<span class="number">6</span>))</span><br><span class="line"><span class="comment"># 36</span></span><br></pre></td></tr></table></figure><h3 id="Map函数"><a href="#Map函数" class="headerlink" title="Map函数"></a>Map函数</h3><p>map函数接收的是两个参数，一个函数，一个序列，其功能是将序列中的值处理再依次返回至列表内。其返回值为一个迭代器对象。</p><figure class="highlight python"><figcaption><span>匿名函数方式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">ret = map(<span class="keyword">lambda</span> x:x ** <span class="number">2</span>,alist)</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>def函数方式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="keyword">return</span> n**<span class="number">2</span></span><br><span class="line"></span><br><span class="line">ret = map(func,alist)</span><br></pre></td></tr></table></figure><p>这里的返回值是一个迭代器对象，所以我们需要查看迭代器对象的三种方法</p><figure class="highlight python"><figcaption><span>第一种</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(list(ret)) <span class="comment">#[1, 4, 9, 16, 25]</span></span><br><span class="line">print(tuple(ret)) <span class="comment">#(1, 4, 9, 16, 25)</span></span><br><span class="line">print(set(ret)) <span class="comment">#&#123;1, 4, 9, 16, 25&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>第二种</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ret:</span><br><span class="line">    print(i,end=<span class="string">" "</span>)</span><br><span class="line"><span class="comment"># 1 4 9 16 25</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>第三种</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用循环来获取，但是一直next获取，当获取不到会报无法停止的错误，所以使用try来处理。</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(next(ret),end=<span class="string">" "</span>)</span><br><span class="line">    <span class="keyword">except</span> StopIteration <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># 1 4 9 16 25</span></span><br></pre></td></tr></table></figure><h3 id="Sorted函数"><a href="#Sorted函数" class="headerlink" title="Sorted函数"></a>Sorted函数</h3><p>sort 与 sorted 区别：<br>sort 是应用在 list 上的方法，sorted 可以对所有可迭代的对象进行排序操作。<br>list 的 sort 方法返回的是对已经存在的列表进行操作，无返回值，而内建函数 sorted 方法返回的是一个新的 list，而不是在原来的基础上进行的操作,对原list无影响</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">slist = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>]</span><br><span class="line">slist.sort()</span><br><span class="line">print(slist)    <span class="comment"># [1,2,3,4,5]</span></span><br><span class="line"></span><br><span class="line">alist = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>]</span><br><span class="line">print(sorted(alist)) <span class="comment"># [1,2,3,4,5]</span></span><br><span class="line">print(alist)    <span class="comment"># [1,4,2,5,3]</span></span><br></pre></td></tr></table></figure><p>sorted接收三个参数(iterable,key,reverse)<br>其中reverse=False是降序(默认)，reverse=True是升序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alist = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">-6</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">print(sorted(alist,key=abs,reverse=<span class="literal">True</span>))<span class="comment">#这里我用了abs绝对值函数</span></span><br><span class="line"><span class="comment">#[-6, 5, 4, 3, 1]-6的绝对值是6，所以在第一位</span></span><br></pre></td></tr></table></figure><h3 id="Reduce函数"><a href="#Reduce函数" class="headerlink" title="Reduce函数"></a>Reduce函数</h3><p>reduce计算过程：<br>先将第一个，第二个元素进行操作，然后把第一二个操作之后的结果和第三个元素进行操作，直到结束</p><figure class="highlight python"><figcaption><span>lambda表达式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#reduce函数不是内置函数，而是在模块functools中的函数，故需要导包</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce </span><br><span class="line"></span><br><span class="line">alist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">res = reduce(<span class="keyword">lambda</span> x,y:x+y,alist)</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># 15</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>def函数方式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a,b)</span>:</span></span><br><span class="line"><span class="keyword">return</span> a*b</span><br><span class="line">res = reduce(func,alist)</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># 120</span></span><br></pre></td></tr></table></figure><h3 id="Filter函数"><a href="#Filter函数" class="headerlink" title="Filter函数"></a>Filter函数</h3><p>filter() 函数用于过滤序列，过滤掉不符合条件的元素，返回由符合条件元素组成的新列表。该接收两个参数，第一个为函数，第二个为序列，序列的每个元素作为参数传递给函数进行判，然后返回 True 或 False，最后将返回 True 的元素放到新列表中。<br>filter函数的返回值也是一个可迭代对象</p><figure class="highlight python"><figcaption><span>def函数方式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line">alist = filter(func, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>])</span><br><span class="line">print(list(alist))</span><br><span class="line"><span class="comment"># [1,3,5,7,9]</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>lambda表达式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = filter(<span class="keyword">lambda</span> a:a%<span class="number">2</span>==<span class="number">1</span>,[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>])</span><br><span class="line">print(list(res))</span><br><span class="line"><span class="comment"># [1,3,5,7,9]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;什么是高阶函数？&quot;&gt;&lt;a href=&quot;#什么是高阶函数？&quot; class=&quot;headerlink&quot; title=&quot;什么是高阶函数？&quot;&gt;&lt;/a&gt;什么是高阶函数？&lt;/h3&gt;&lt;p&gt;高阶函数：一个函数可以作为参数传给另外一个函数，或者一个函数的返回值为另外一个函数（若返回值为该函数本身，则为递归），满足其一则为高阶函数。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>&#39;结合python实现支付宝退款功能&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/20/%E7%BB%93%E5%90%88python%E5%AE%9E%E7%8E%B0%E6%94%AF%E4%BB%98%E5%AE%9D%E9%80%80%E6%AC%BE%E5%8A%9F%E8%83%BD/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/20/%E7%BB%93%E5%90%88python%E5%AE%9E%E7%8E%B0%E6%94%AF%E4%BB%98%E5%AE%9D%E9%80%80%E6%AC%BE%E5%8A%9F%E8%83%BD/</id>
    <published>2020-06-20T09:58:39.000Z</published>
    <updated>2020-06-20T10:07:49.286Z</updated>
    
    <content type="html"><![CDATA[<p>有支付就肯定有退款，当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。 交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款 支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的商户订单号和设置不同的退款单号。一笔退款失败后重新提交，要采用原来的退款单号。总退款金额不能超过用户实际支付金额。</p><a id="more"></a><p>前面已经写过<a href="https://okwzh.cn/2020/06/16/%E6%94%AF%E4%BB%98%E5%AE%9D%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98/" target="_blank" rel="noopener">结合python实现支付宝的支付功能</a>。<br>支付宝官方文档：<a href="https://opendocs.alipay.com/apis/api_1/alipay.trade.refund" target="_blank" rel="noopener">https://opendocs.alipay.com/apis/api_1/alipay.trade.refund</a></p><p>由于之前写的有支付价格和支付宝的订单号，所以我们根据这两个参数，实现退款。</p><p>我们之前写的pay.py已经有退款方法了，所以我们需要直接调用就可以了。</p><figure class="highlight python"><figcaption><span>在pay.py已经写入</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#请求支付宝退款接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">api_alipay_trade_refund</span><span class="params">(self, refund_amount, out_trade_no=None, trade_no=None, **kwargs)</span>:</span></span><br><span class="line">    biz_content = &#123;</span><br><span class="line">        <span class="string">"refund_amount"</span>: refund_amount</span><br><span class="line">    &#125;</span><br><span class="line">    biz_content.update(**kwargs)</span><br><span class="line">    <span class="keyword">if</span> out_trade_no:</span><br><span class="line">        biz_content[<span class="string">"out_trade_no"</span>] = out_trade_no</span><br><span class="line">    <span class="keyword">if</span> trade_no:</span><br><span class="line">        biz_content[<span class="string">"trade_no"</span>] = trade_no</span><br><span class="line">    data = self.build_body(<span class="string">"alipay.trade.refund"</span>, biz_content)</span><br><span class="line">    url = self.__gateway + <span class="string">"?"</span> + self.sign_data(data)</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    html = r.content.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    <span class="keyword">return</span> html</span><br></pre></td></tr></table></figure><p>现在我们需要在写一个退款的视图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">refund</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#实例化支付类</span></span><br><span class="line">    alipay = get_ali_object()</span><br><span class="line">    <span class="comment">#调用退款方法</span></span><br><span class="line">    order_string = alipay.api_alipay_trade_refund(</span><br><span class="line">    <span class="comment">#订单号，一定要注意，这是支付成功后返回的唯一订单号</span></span><br><span class="line">    out_trade_no=<span class="string">"20190503214355"</span>,</span><br><span class="line">    <span class="comment">#退款金额，注意精确到分，不要超过订单支付总金额</span></span><br><span class="line">    refund_amount=<span class="string">"20.00"</span>,</span><br><span class="line">    <span class="comment">#回调网址</span></span><br><span class="line">    notify_url=<span class="string">'http://localhost:8000/md_admin/alipayreturn'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(order_string)</span><br></pre></td></tr></table></figure><p>如果订单号和退款金额正确的话，请求该接口就会返回退款成功的返回值，查看支付宝钱包，相应的退款应该会及时到账<br><img src="/img/python/%E6%94%AF%E4%BB%98%E5%AE%9D%E9%80%80%E6%AC%BE.png" alt="支付宝退款返回参数"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;有支付就肯定有退款，当交易发生之后一段时间内，由于买家或者卖家的原因需要退款时，卖家可以通过退款接口将支付款退还给买家，支付宝将在收到退款请求并且验证成功之后，按照退款规则将支付款按原路退到买家帐号上。 交易超过约定时间（签约时设置的可退款时间）的订单无法进行退款 支付宝退款支持单笔交易分多次退款，多次退款需要提交原支付订单的商户订单号和设置不同的退款单号。一笔退款失败后重新提交，要采用原来的退款单号。总退款金额不能超过用户实际支付金额。&lt;/p&gt;
    
    </summary>
    
    
      <category term="支付" scheme="https://wzh3683.github.io/hexo_blog/categories/%E6%94%AF%E4%BB%98/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
      <category term="支付" scheme="https://wzh3683.github.io/hexo_blog/tags/%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>&#39;使用python结合钉钉配置开发自定义机器人&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/20/%E4%BD%BF%E7%94%A8python%E7%BB%93%E5%90%88%E9%92%89%E9%92%89%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/20/%E4%BD%BF%E7%94%A8python%E7%BB%93%E5%90%88%E9%92%89%E9%92%89%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%BA%E5%99%A8%E4%BA%BA/</id>
    <published>2020-06-20T08:56:39.000Z</published>
    <updated>2020-06-20T10:28:25.005Z</updated>
    
    <content type="html"><![CDATA[<p>之前使用钉钉做过<a href="https://okwzh.cn/2020/04/28/day08-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95-%E9%92%89%E9%92%89%E7%99%BB%E5%BD%95/" target="_blank" rel="noopener">三方登录</a>,今天我们来说一下使用python结合钉钉做一个钉钉群自定义机器人。</p><p>这个功能属于比较极客的功能，它可以将第三方服务的信息聚合到钉钉群中，实现信息的自动化同步，例如：通过聚合Github、Gitlab等源码管理服务，实现源码更新同步；通过聚合Trello、JIRA等项目协调服务，实现项目信息同步；同事，支持Webhook协议的自定义接入，支持更多可能性，例如：将运维报警提醒、自动化测试的结果报告提醒、工作、生活日程安排（上班打卡、下班吃饭、健身、读书、生日、纪念日…）等等的提醒，通过自定义机器人聚合到钉钉中。</p><a id="more"></a><p>过关于钉钉机器人网上的一些攻略年代都比较久远，代码很多都基于python2，为了与时俱进，我们尝试用python3.7来开发配置钉钉自定义机器人。</p><p>查看机器人官方文档：<a href="https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq</a><br>首先明确一点，钉钉自定义机器人早就不支持在手机端创建了，所以得使用你的pc端或者mac端的钉钉客户端</p><h3 id="创建机器人"><a href="#创建机器人" class="headerlink" title="创建机器人"></a>创建机器人</h3><p>在需要机器人的聊天群界面，点击智能群助手(一个群可以添加6个自定义机器人，而且还得有管理员权限)</p><p><img src="/img/python/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA1.png" alt="添加自定义机器人"></p><p>我们选择添加机器人</p><p><img src="/img/python/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA2.png" alt="添加自定义机器人"></p><p>点进去发现好多机器人，各有各的功能，本次我们选择自定义机器人。</p><p><img src="/img/python/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA3.png" alt="添加自定义机器人"></p><p>钉钉的机器人基于webhook协议，webhook呢是一个api概念,是微服务api的使用范式之一,也被成为反向api,即前端不主动发送请求,完全由后端推送。<br>在添加机器人页面填写一些基本信息。</p><p><img src="/img/python/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA4.png" alt="添加自定义机器人"></p><p>需要注意的是，在安全设置一栏里，我们选择加签的方式来验证，在此说明一下，钉钉机器人的安全策略有三种，第一种是使用关键字，就是说你推送的消息里必须包含你创建机器人时定义的关键字，如果不包含就推送不了消息，第二种就是使用加密签名，第三种是定义几个ip源，非这些源的请求会被拒绝，综合来看还是第二种又安全又灵活。</p><p><img src="/img/python/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA5.png" alt="添加自定义机器人"></p><p>创建成功后，系统会分配给你一个webhook地址，这个地址需要保存一下，地址中有唯一的accesstoken</p><p>这是我们的钉钉机器人已经添加完成了，于是我们要写入让他进行自动发送消息</p><h3 id="使用机器人发送消息"><a href="#使用机器人发送消息" class="headerlink" title="使用机器人发送消息"></a>使用机器人发送消息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入需要的模块</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">timestamp = str(round(time.time() * <span class="number">1000</span>))</span><br><span class="line">secret = <span class="string">'创建机器人的签名'</span></span><br><span class="line">secret_enc = secret.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">string_to_sign = <span class="string">'&#123;&#125;\n&#123;&#125;'</span>.format(timestamp, secret)</span><br><span class="line">string_to_sign_enc = string_to_sign.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">hmac_code = hmac.new(secret_enc, string_to_sign_enc, digestmod=hashlib.sha256).digest()</span><br><span class="line">sign = urllib.parse.quote(base64.b64encode(hmac_code))</span><br><span class="line"><span class="comment"># print(timestamp)</span></span><br><span class="line"><span class="comment"># print(sign)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests,json   <span class="comment">#导入依赖库</span></span><br><span class="line">headers=&#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;   <span class="comment">#定义数据类型</span></span><br><span class="line">webhook = <span class="string">'你的webhook地址&amp;timestamp='</span>+timestamp+<span class="string">"&amp;sign="</span>+sign</span><br><span class="line"><span class="comment">#定义要发送的数据</span></span><br><span class="line"><span class="comment">#"at": &#123;"atMobiles": "['"+ mobile + "']"</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"msgtype"</span>: <span class="string">"text"</span>,</span><br><span class="line">    <span class="string">"text"</span>: &#123;<span class="string">"content"</span>: <span class="string">'我是机器人,这是我发的第一条消息'</span>&#125;,</span><br><span class="line">    <span class="string">"isAtAll"</span>: <span class="literal">True</span>&#125;</span><br><span class="line">res = requests.post(webhook, data=json.dumps(data), headers=headers)   <span class="comment">#发送post请求</span></span><br><span class="line"></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>这是我们已经发现机器人可以推送消息了，看效果：<br><img src="/img/python/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA6.png" alt="机器人推送消息"></p><h3 id="关于发送消息类型和数据格式"><a href="#关于发送消息类型和数据格式" class="headerlink" title="关于发送消息类型和数据格式"></a>关于发送消息类型和数据格式</h3><figure class="highlight js"><figcaption><span>文本格式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"msgtype"</span>: <span class="string">"text"</span>,  <span class="comment">//文本</span></span><br><span class="line">    <span class="string">"text"</span>: &#123;</span><br><span class="line">        <span class="string">"content"</span>: <span class="string">"我就是我, 是不一样的烟火@156xxxx8827"</span> <span class="comment">//文本内容</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">"at"</span>: &#123;     <span class="comment">//艾特对象</span></span><br><span class="line">        <span class="string">"atMobiles"</span>: [</span><br><span class="line">            <span class="string">"156xxxx8827"</span>, </span><br><span class="line">            <span class="string">"189xxxx8325"</span></span><br><span class="line">        ], </span><br><span class="line">        <span class="string">"isAtAll"</span>: <span class="literal">false</span>    <span class="comment">//是否艾特所有人</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>link格式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"msgtype"</span>: <span class="string">"link"</span>, </span><br><span class="line">    <span class="string">"link"</span>: &#123;</span><br><span class="line">        <span class="string">"text"</span>: <span class="string">"这个即将发布的新版本，创始人xx称它为红树林。而在此之前，每当面临重大升级，产品经理们都会取一个应景的代号，这一次，为什么是红树林"</span>, </span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"时代的火车向前开"</span>, </span><br><span class="line">        <span class="string">"picUrl"</span>: <span class="string">""</span>, </span><br><span class="line">        <span class="string">"messageUrl"</span>: <span class="string">"https://www.dingtalk.com/s?__biz=MzA4NjMwMTA2Ng==&amp;mid=2650316842&amp;idx=1&amp;sn=60da3ea2b29f1dcc43a7c8e4a7c97a16&amp;scene=2&amp;srcid=09189AnRJEdIiWVaKltFzNTw&amp;from=timeline&amp;isappinstalled=0&amp;key=&amp;ascene=2&amp;uin=&amp;devicetype=android-23&amp;version=26031933&amp;nettype=WIFI"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>markdown类型</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     <span class="string">"msgtype"</span>: <span class="string">"markdown"</span>,</span><br><span class="line">     <span class="string">"markdown"</span>: &#123;</span><br><span class="line">         <span class="string">"title"</span>:<span class="string">"杭州天气"</span>,</span><br><span class="line">         <span class="string">"text"</span>: <span class="string">"#### 杭州天气 @150XXXXXXXX \n&gt; 9度，西北风1级，空气良89，相对温度73%\n&gt; ![screenshot](https://img.alicdn.com/tfs/TB1NwmBEL9TBuNjy1zbXXXpepXa-2400-1218.png)\n&gt; ###### 10点20分发布 [天气](https://www.dingalk.com) \n"</span></span><br><span class="line">     &#125;,</span><br><span class="line">      <span class="string">"at"</span>: &#123;</span><br><span class="line">          <span class="string">"atMobiles"</span>: [</span><br><span class="line">              <span class="string">"150XXXXXXXX"</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"isAtAll"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>关于类型还有多种及参数，点击<a href="https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq/uKPlK" target="_blank" rel="noopener">https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq/uKPlK</a>查看</p><h3 id="检验失信信息"><a href="#检验失信信息" class="headerlink" title="检验失信信息"></a>检验失信信息</h3><p>针对上边选择设置的三种方式，至少设置其中一种，以进行安全保护。否则会校验不通过</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 消息内容中不包含任何关键词</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"errcode"</span>:<span class="number">310000</span>,</span><br><span class="line">  <span class="string">"errmsg"</span>:<span class="string">"keywords not in content"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// timestamp 无效</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"errcode"</span>:<span class="number">310000</span>,</span><br><span class="line">  <span class="string">"errmsg"</span>:<span class="string">"invalid timestamp"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 签名不匹配</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"errcode"</span>:<span class="number">310000</span>,</span><br><span class="line">  <span class="string">"errmsg"</span>:<span class="string">"sign not match"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IP地址不在白名单</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"errcode"</span>:<span class="number">310000</span>,</span><br><span class="line">  <span class="string">"errmsg"</span>:<span class="string">"ip X.X.X.X not in whitelist"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前使用钉钉做过&lt;a href=&quot;https://okwzh.cn/2020/04/28/day08-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95-%E9%92%89%E9%92%89%E7%99%BB%E5%BD%95/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;三方登录&lt;/a&gt;,今天我们来说一下使用python结合钉钉做一个钉钉群自定义机器人。&lt;/p&gt;
&lt;p&gt;这个功能属于比较极客的功能，它可以将第三方服务的信息聚合到钉钉群中，实现信息的自动化同步，例如：通过聚合Github、Gitlab等源码管理服务，实现源码更新同步；通过聚合Trello、JIRA等项目协调服务，实现项目信息同步；同事，支持Webhook协议的自定义接入，支持更多可能性，例如：将运维报警提醒、自动化测试的结果报告提醒、工作、生活日程安排（上班打卡、下班吃饭、健身、读书、生日、纪念日…）等等的提醒，通过自定义机器人聚合到钉钉中。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
      <category term="钉钉" scheme="https://wzh3683.github.io/hexo_blog/tags/%E9%92%89%E9%92%89/"/>
    
  </entry>
  
  <entry>
    <title>&#39;关于celery不执行定时任务的问题&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/19/%E5%85%B3%E4%BA%8Ecelery%E4%B8%8D%E6%89%A7%E8%A1%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/19/%E5%85%B3%E4%BA%8Ecelery%E4%B8%8D%E6%89%A7%E8%A1%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2020-06-19T13:43:31.000Z</published>
    <updated>2020-06-19T14:16:27.887Z</updated>
    
    <content type="html"><![CDATA[<p>使用celery做定时任务时，出现一个错误，就是不执行定时任务。刚开始在在做测试时是每分钟测试，然后我发现并没有执行这个服务。于是在花费了定量时间，然后解决了这个bug。</p><a id="more"></a><h3 id="celery定时任务bug"><a href="#celery定时任务bug" class="headerlink" title="celery定时任务bug"></a>celery定时任务bug</h3><p>就是简单做celery定时任务时，我发现逻辑和代码并没有任何问题，但是就是不启动。<br>于是进行百度，刚开始说的是可能是celery版本的问题，但是发现并不是这个问题。</p><p>经过测试，我把crontab中的参数hour去掉，把minute设置每分钟，于是我发现每分钟都会执行。<br>所以可以确定是hour，也就是时区问题。但是机器上的时间和代码里面的时区都没有问题，那可能是celery本身的问题了。</p><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>默认celery的时区为UTC</p><h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><p>将celery定时任务设置为根据本地时区触发</p><p>默认celery的时区为UTC，如果要在django项目中将celery定时任务配置为根据本地时区触发，则需要修改</p><p>在settings.py中添加以下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CELERY_TIMEZONE=<span class="string">'Asia/Shanghai'</span></span><br><span class="line">CELERY_ENABLE_UTC=<span class="literal">False</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>定时任务代码附上</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定时任务</span></span><br><span class="line"><span class="comment">#导入celery定时模块</span></span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> schedules</span><br><span class="line"><span class="comment">#导入时间模块</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CELERY_TIMEZONE=<span class="string">'Asia/Shanghai'</span></span><br><span class="line">CELERY_ENABLE_UTC=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CELERY_BEAT_SCHEDULE = &#123;</span></span><br><span class="line"><span class="comment">#     #定义定时任务</span></span><br><span class="line"><span class="comment">#     'celery_datetime_work':&#123;</span></span><br><span class="line"><span class="comment">#         'task':'myapp.tasks.async_test',   #任务名称</span></span><br><span class="line"><span class="comment">#         'schedule':timedelta(seconds=60)</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">CELERY_BEAT_SCHEDULE = &#123;</span><br><span class="line">    <span class="comment">#定义定时任务</span></span><br><span class="line">    <span class="string">'celery_datetime_work'</span>:&#123;</span><br><span class="line">        <span class="comment">#天气预报结合钉钉机器人</span></span><br><span class="line">        <span class="string">'task'</span>: <span class="string">'myapp.tasks.func'</span>, <span class="comment">#我的celery任务</span></span><br><span class="line">        <span class="comment">#定时任务每天8.30</span></span><br><span class="line">        <span class="string">'schedule'</span>: crontab(minute=<span class="string">'30'</span>,hour=<span class="number">8</span>),</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用celery做定时任务时，出现一个错误，就是不执行定时任务。刚开始在在做测试时是每分钟测试，然后我发现并没有执行这个服务。于是在花费了定量时间，然后解决了这个bug。&lt;/p&gt;
    
    </summary>
    
    
      <category term="celery" scheme="https://wzh3683.github.io/hexo_blog/categories/celery/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
      <category term="celery" scheme="https://wzh3683.github.io/hexo_blog/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>&#39;hexo博客美化二&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/17/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E4%BA%8C/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/17/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E4%BA%8C/</id>
    <published>2020-06-17T13:59:40.000Z</published>
    <updated>2020-06-19T03:32:17.344Z</updated>
    
    <content type="html"><![CDATA[<p>前面已经讲过hexo博客的美化，这是继续更新的。</p><a id="more"></a><h3 id="1-添加背景音乐"><a href="#1-添加背景音乐" class="headerlink" title="1.添加背景音乐"></a>1.添加背景音乐</h3><p>打开<a href="https://music.163.com/" target="_blank" rel="noopener">网页版网易云音乐</a>，选择你准备添加的背景音乐，点击生成外链播放器，前提是要有版权，不然是无法生成外链播放器的，复制底下的HTML代码<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%B7%BB%E5%8A%A0%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90%E4%B8%80.png" alt="添加背景音乐一"><br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%B7%BB%E5%8A%A0%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90%E4%BA%8C.png" alt="添加背景音乐二"><br>然后将此代码放到你想要放的地方，比如放在博客的尾部，则打开 \themes\layout_partial\footer.ejs 文件，将复制的HTML代码粘贴进去，再进行适当的位置设置让播放器更美观，其中 auto=1 表示打开网页自动播放音乐，auto=0 表示关闭自动播放音乐</p><p>加载页面，最终展示效果<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%B7%BB%E5%8A%A0%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90%E4%B8%89.png" alt="背景音乐展示效果"></p><h3 id="2-添加地图仪"><a href="#2-添加地图仪" class="headerlink" title="2.添加地图仪"></a>2.添加地图仪</h3><p>它提供网站访客地理信息，可以以2D、3D等形式显示<br><a href="http://www.revolvermaps.com/" target="_blank" rel="noopener">小地球仪</a></p><p><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%B7%BB%E5%8A%A0%E5%B0%8F%E5%9C%B0%E5%9B%BE%E4%BB%AA%E4%B8%80.png" alt="选择自己喜欢的小地图仪"><br>复制代码放到自己想放的地方，比如放在博客的尾部，则打开 \themes\layout_partial\footer.ejs 文件，将复制的HTML代码粘贴进去。<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%B7%BB%E5%8A%A0%E5%B0%8F%E5%9C%B0%E5%9B%BE%E4%BB%AA%E4%BA%8C.png" alt="添加小地图仪二"></p><p>加载页面最终实现效果：<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%B7%BB%E5%8A%A0%E5%B0%8F%E5%9C%B0%E5%9B%BE%E4%BB%AA%E4%B8%89.png" alt="最终展示效果"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前面已经讲过hexo博客的美化，这是继续更新的。&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="https://wzh3683.github.io/hexo_blog/categories/hexo/"/>
    
    
      <category term="hexo" scheme="https://wzh3683.github.io/hexo_blog/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>&#39;paypal跨境支付&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/17/paypal%E8%B7%A8%E5%A2%83%E6%94%AF%E4%BB%98/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/17/paypal%E8%B7%A8%E5%A2%83%E6%94%AF%E4%BB%98/</id>
    <published>2020-06-17T02:00:58.000Z</published>
    <updated>2020-06-17T12:55:46.511Z</updated>
    
    <content type="html"><![CDATA[<p>在公司中，支付是必不可缺的的重要系统之一。有的公司如果涉及到境外支付，就一定听说过或使用说PayPal。<br>PayPal支付的优势就是其业务网络遍布全球。目前PayPal的庞大网络覆盖了全球200多个国家，可提供20多种语言服务，并接受100多种货币付款和56种货币提现。同时，还允许在账户中持有25种货币余额。换句话说，只要付款人拥有一个PayPal账户，他就拥有了在200多个国家进行电子支付购物，并在需要服务的时候享受到母语支持的各种便捷服务。</p><a id="more"></a><p>注册PayPal官网账号：<a href="https://www.paypal.com" target="_blank" rel="noopener">https://www.paypal.com</a><br>PayPal开发者平台：<a href="https://developer.paypal.com/developer/accounts/" target="_blank" rel="noopener">https://developer.paypal.com/developer/accounts/</a></p><p>注册成功之后，进去PayPal沙盒应用：<a href="https://developer.paypal.com/developer/accounts/" target="_blank" rel="noopener">https://developer.paypal.com/developer/accounts/</a><br>然后PayPal会默认给我们创建两个账号，一个是商家的，一个是个户的。当然也可以点击Create account自己创建需要的账号<br><img src="/img/%E6%94%AF%E4%BB%98/%E9%BB%98%E8%AE%A4%E8%B4%A6%E5%8F%B7.png" alt="分配的默认账号"></p><h3 id="支付业务"><a href="#支付业务" class="headerlink" title="支付业务"></a>支付业务</h3><p>以个人账户对商户进行支付业务。</p><p>应用管理页面：<a href="https://developer.paypal.com/developer/applications/" target="_blank" rel="noopener">https://developer.paypal.com/developer/applications/</a></p><p>这时我们可以发现他给我们默认分配了应用。<br><img src="/img/%E6%94%AF%E4%BB%98/%E9%BB%98%E8%AE%A4%E5%BA%94%E7%94%A8.png" alt="分配的默认应用"></p><p>点击我们的默认应用，我们可以发现应用的client_id和client_secret。<br><img src="/img/%E6%94%AF%E4%BB%98/client_ID.png" alt="应用的ID和Secret"></p><p>进入我们的账号设置<br><img src="/img/%E6%94%AF%E4%BB%98/%E8%BF%9B%E5%85%A5%E8%B4%A6%E5%8F%B7%E8%AE%BE%E7%BD%AE.png" alt="进入账号设置"></p><p>可以得知我们的个人账号和账号密码<br><img src="/img/%E6%94%AF%E4%BB%98/%E4%B8%AA%E4%BA%BA%E8%B4%A6%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81.png" alt="个人账号和面膜"></p><p>修改我们个人账号的金额，让我们有足以的价格进行购买测试<br><img src="/img/%E6%94%AF%E4%BB%98/%E4%B8%AA%E4%BA%BA%E8%B4%A6%E6%88%B7%E9%87%91%E9%A2%9D.png" alt="修改个人账户金额"></p><h3 id="进行购买测试"><a href="#进行购买测试" class="headerlink" title="进行购买测试"></a>进行购买测试</h3><p>安装PayPal在python的sdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install paypalrestsdk</span><br></pre></td></tr></table></figure><p>在djagno中新建一个支付视图views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">url:</span><br><span class="line">    path(<span class="string">'pay/'</span>,payment),<span class="comment">#跳转</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> paypalrestsdk</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payment</span><span class="params">(request)</span>:</span></span><br><span class="line">    paypalrestsdk.configure(&#123;</span><br><span class="line">  <span class="string">"mode"</span>: <span class="string">"sandbox"</span>, <span class="comment"># sandbox代表沙盒</span></span><br><span class="line">  <span class="string">"client_id"</span>: <span class="string">"你的client_id"</span>,</span><br><span class="line">  <span class="string">"client_secret"</span>: <span class="string">"你的client_secret"</span> &#125;)</span><br><span class="line"></span><br><span class="line">    payment = paypalrestsdk.Payment(&#123;</span><br><span class="line">        <span class="string">"intent"</span>: <span class="string">"sale"</span>,</span><br><span class="line">        <span class="string">"payer"</span>: &#123;</span><br><span class="line">            <span class="string">"payment_method"</span>: <span class="string">"paypal"</span>&#125;,</span><br><span class="line">        <span class="string">"redirect_urls"</span>: &#123;</span><br><span class="line">            <span class="string">"return_url"</span>: <span class="string">"http://localhost:8000/palpay/pay/"</span>,<span class="comment">#支付成功跳转页面</span></span><br><span class="line">            <span class="comment"># "return_url": "http://localhost:8000/palpay/pay/?"+'order='+str(snoworder)+'&amp;uid='+str(uid) #进行加参，到修改</span></span><br><span class="line">            <span class="string">"cancel_url"</span>: <span class="string">"http://localhost:3000/paypal/cancel/"</span>&#125;,<span class="comment">#取消支付页面</span></span><br><span class="line">        <span class="string">"transactions"</span>: [&#123;</span><br><span class="line">            <span class="string">"amount"</span>: &#123;</span><br><span class="line">                <span class="string">"total"</span>: <span class="string">"5.00"</span>,</span><br><span class="line">                <span class="string">"currency"</span>: <span class="string">"USD"</span>&#125;,</span><br><span class="line">            <span class="string">"description"</span>: <span class="string">"这是一个订单测试"</span>&#125;]&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payment.create():</span><br><span class="line">        print(<span class="string">"Payment created successfully"</span>)</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> payment.links:</span><br><span class="line">            <span class="keyword">if</span> link.rel == <span class="string">"approval_url"</span>:</span><br><span class="line">                approval_url = str(link.href)</span><br><span class="line">                print(<span class="string">"Redirect for approval: %s"</span> % (approval_url))</span><br><span class="line">                <span class="keyword">return</span> redirect(approval_url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(payment.error)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"支付失败"</span>)</span><br></pre></td></tr></table></figure><p>这里解释一下重点参数，return_url是支付成功后回调的页面，paypal会将一个支付者id回传，然后服务端需要验证支付才能真的完成支付，total是付款金额，精确到分，currency是币种，支持多钟类型的货币。</p><p>当Django的服务端创建好支付订单后，重定向到paypal的沙盒环境，这时候一定要使用沙盒的个人账号进行登录和支付。<br><img src="/img/%E6%94%AF%E4%BB%98/%E4%BB%98%E6%AC%BE.png" alt="paypal支付订单"><br>支付完成后，会跳回刚刚传过去的回调页面：<a href="http://localhost:8000/palpay/pay/?paymentId=PAYID-L3SYORA3C031930S1733650J&amp;token=EC-9TG269735K620131N&amp;PayerID=ETYYRCDN8C3XJ" target="_blank" rel="noopener">http://localhost:8000/palpay/pay/?paymentId=PAYID-L3SYORA3C031930S1733650J&amp;token=EC-9TG269735K620131N&amp;PayerID=ETYYRCDN8C3XJ</a>  </p><p>这里paypal会传过来三个参数，支付id,token和支付者id,然后因为我要修改参数，所以我对回调网址进行加参，</p><p>此时，在回调方法里，我们需要通过支付者id进行确认验证支付</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">url:</span><br><span class="line">    path(<span class="string">'palpay/pay/'</span>,payment_execute),<span class="comment">#成功回调</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payment_execute</span><span class="params">(request)</span>:</span></span><br><span class="line">    paymentid = request.GET.get(<span class="string">"paymentId"</span>) <span class="comment">#支付id</span></span><br><span class="line">    payerid = request.GET.get(<span class="string">"PayerID"</span>)  <span class="comment">#支付者id</span></span><br><span class="line">    order = request.GET.get(<span class="string">'order'</span>) <span class="comment">#获取订单</span></span><br><span class="line">    uid = request.GET.get(<span class="string">'uid'</span>)<span class="comment">#获取用户id</span></span><br><span class="line">    print(<span class="string">'订单ID:%s,支付者ID:%s，雪花订单号:%s,uid:%s'</span>%(paymentid,payerid,order,uid))</span><br><span class="line"></span><br><span class="line">    payment = paypalrestsdk.Payment.find(paymentid)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payment.execute(&#123;<span class="string">"payer_id"</span>: payerid&#125;):</span><br><span class="line">        <span class="keyword">if</span> order <span class="keyword">and</span> payerid <span class="keyword">and</span> paymentid:</span><br><span class="line">            order_end = int(order[<span class="number">-1</span>])</span><br><span class="line">            print(<span class="string">'订单号最后一位'</span>,order_end)</span><br><span class="line">            <span class="keyword">if</span> int(order_end) &lt; <span class="number">5</span> <span class="keyword">or</span> int(uid[<span class="number">-1</span>]) &lt; <span class="number">5</span>:</span><br><span class="line">                order = OrderOne.objects.filter(order=order).first()</span><br><span class="line">                order.status = <span class="number">2</span></span><br><span class="line">                order.save()</span><br><span class="line">                print(<span class="string">"修改一表订单状态成功"</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">'http://localhost:8080/myorder/'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                order = OrderTwo.objects.filter(order=order).first()</span><br><span class="line">                order.status = <span class="number">2</span></span><br><span class="line">                order.save()</span><br><span class="line">                print(<span class="string">"修改二表订单状态成功"</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">'http://localhost:8080/myorder/'</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'未获取到单号，请重新购买'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(payment.error) <span class="comment"># Error Hash</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"支付失败"</span>)</span><br></pre></td></tr></table></figure><p>这时再看我们的个人账户页面，发现已经扣款成功，说明整个流程已经走完。<br><img src="/img/%E6%94%AF%E4%BB%98/%E8%B4%AD%E4%B9%B0%E4%B9%8B%E5%90%8E%E4%BB%B7%E6%A0%BC.png" alt="购买成功扣款"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>整个支付流程相对支付宝来说，更加的紧凑，但是做支付安全是第一要务，就个人体验（仅是个人体验）层面来说，支付宝在安全方面做的还是要比Paypal略强一些，起码在信用卡欺诈和盗刷方面风控做的更好，在风险保障和赔付方面都有提供保险，当然由于金融环境的差异较大，并不是说Paypal的风控做的不好，只是机制不同，在国外，如果持卡人的信用卡被盗刷，一般发卡组织会让商家去承担责任，而国内只能在交易环节设置更多的验证，本质上说是要持卡人承担责任。这也是为什么支付宝的风控看起来更好的原因。</p><p>最后就是关于费率问题，Paypal官方给出的费率是每笔交易收取3.9%+$0.3（根据你的交易流水，比例可以优惠，具体下限看接入者的月营业额度），不过这可是美刀，不得不说这个费率是相当的高，但是国内做境外支付的电商，一般还是要接入Paypal作为支付方式。支付宝的费率基本上在1.2%左右，具体的费率也看交易流水，有实力的下限可以做到基本没有，单纯的看费率似乎支付宝更有优势，但是别忘记了，这样对比是不科学的，因为凡是接入Paypal的都是看中覆盖外币业务的地区，费率则是投资人该考虑的问题了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在公司中，支付是必不可缺的的重要系统之一。有的公司如果涉及到境外支付，就一定听说过或使用说PayPal。&lt;br&gt;PayPal支付的优势就是其业务网络遍布全球。目前PayPal的庞大网络覆盖了全球200多个国家，可提供20多种语言服务，并接受100多种货币付款和56种货币提现。同时，还允许在账户中持有25种货币余额。换句话说，只要付款人拥有一个PayPal账户，他就拥有了在200多个国家进行电子支付购物，并在需要服务的时候享受到母语支持的各种便捷服务。&lt;/p&gt;
    
    </summary>
    
    
      <category term="支付" scheme="https://wzh3683.github.io/hexo_blog/categories/%E6%94%AF%E4%BB%98/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
      <category term="支付" scheme="https://wzh3683.github.io/hexo_blog/tags/%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>&#39;hexo博客美化一&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/16/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E4%B8%80/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/16/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E4%B8%80/</id>
    <published>2020-06-16T13:31:29.000Z</published>
    <updated>2020-06-17T14:00:01.647Z</updated>
    
    <content type="html"><![CDATA[<p>本文讲述的是添加博客美化的样式<br>请注意：不同主题可能方法有些不同，相同主题不同版本，配置方法也有所差异！</p><p>博客美化前提条件：有一定的前端基础，了解 HTML、CSS、JS，了解 CSS 预处理语言 Sass、Less、Stylus，搞懂 hexo 的目录结构。</p><a id="more"></a><p>博客美化通用步骤：选定主题，认真阅读主题文档，分析主题目录结构，了解每个文件是对应网页哪个部分的，认真阅读美化教程，美化教程本质上只为你提供核心代码和思路，具体代码要添加到哪个地方，需要你自己搞懂主题结构，添加到需要的、合适的位置！</p><p>博客美化终极奥秘：创作第一，体验第二，避免繁杂，简洁为上！</p><h3 id="1-添加卡通人物"><a href="#1-添加卡通人物" class="headerlink" title="1.添加卡通人物"></a>1.添加卡通人物</h3><p>我在逛别人博客的时候偶然发现右下角居然有一个萌萌的卡通人物，还能根据你鼠标位置摇头，瞬间被吸引到了，赶紧也给自己博客添加一个吧！点击此处进入该<a href="https://github.com/EYHN/hexo-helper-live2d" target="_blank" rel="noopener">项目地址</a></p><p>获取live2d依赖库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure><p>输入以下命令，下载相应的模型，将 packagename 更换成模型名称即可，更多模型选择请<a href="https://github.com/xiazeyu/live2d-widget-models" target="_blank" rel="noopener">点击此处</a>，各个模型的预览请访问<a href="https://eyhn.in/" target="_blank" rel="noopener">原作者的博客</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install packagename(模型名称)</span><br></pre></td></tr></table></figure><p>打开站点目录下的 _config.yml 文件，添加如下代码</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">live2d:</span><br><span class="line">  enable: <span class="literal">true</span></span><br><span class="line">  scriptFrom: local</span><br><span class="line">  model:</span><br><span class="line">    use: live2d-widget-model-haruto #模型选择</span><br><span class="line">  display:</span><br><span class="line">    position: right  #模型位置</span><br><span class="line">    width: 150       #模型宽度</span><br><span class="line">    height: 300      #模型高度</span><br><span class="line">  mobile:</span><br><span class="line">    show: false      #是否在手机端显示</span><br></pre></td></tr></table></figure><p>设置好过后我们就拥有了一个卡通人物<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E5%8A%A8%E6%BC%AB%E5%8D%A1%E9%80%9A%E4%BA%BA%E7%89%A9.png" alt="动漫卡通人物"></p><h3 id="2-添加鼠标点击爱心效果"><a href="#2-添加鼠标点击爱心效果" class="headerlink" title="2.添加鼠标点击爱心效果"></a>2.添加鼠标点击爱心效果</h3><p>在 \themes\source\js 下新建文件 love.js，在 love.js 文件中添加以下代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params">e,t,a</span>)</span>&#123;<span class="function"><span class="keyword">function</span> <span class="title">n</span>(<span class="params"></span>)</span>&#123;c(<span class="string">".heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 500%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;"</span>),o(),r()&#125;<span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params"></span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> e=<span class="number">0</span>;e&lt;d.length;e++)d[e].alpha&lt;=<span class="number">0</span>?(t.body.removeChild(d[e].el),d.splice(e,<span class="number">1</span>)):(d[e].y--,d[e].scale+=<span class="number">.004</span>,d[e].alpha-=<span class="number">.013</span>,d[e].el.style.cssText=<span class="string">"left:"</span>+d[e].x+<span class="string">"px;top:"</span>+d[e].y+<span class="string">"px;opacity:"</span>+d[e].alpha+<span class="string">";transform:scale("</span>+d[e].scale+<span class="string">","</span>+d[e].scale+<span class="string">") rotate(45deg);background:"</span>+d[e].color+<span class="string">";z-index:99999"</span>);requestAnimationFrame(r)&#125;<span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> t=<span class="string">"function"</span>==<span class="keyword">typeof</span> e.onclick&amp;&amp;e.onclick;e.onclick=<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;t&amp;&amp;t(),i(e)&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">var</span> a=t.createElement(<span class="string">"div"</span>);a.className=<span class="string">"heart"</span>,d.push(&#123;<span class="attr">el</span>:a,<span class="attr">x</span>:e.clientX<span class="number">-5</span>,<span class="attr">y</span>:e.clientY<span class="number">-5</span>,<span class="attr">scale</span>:<span class="number">1</span>,<span class="attr">alpha</span>:<span class="number">1</span>,<span class="attr">color</span>:s()&#125;),t.body.appendChild(a)&#125;<span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">var</span> a=t.createElement(<span class="string">"style"</span>);a.type=<span class="string">"text/css"</span>;<span class="keyword">try</span>&#123;a.appendChild(t.createTextNode(e))&#125;<span class="keyword">catch</span>(t)&#123;a.styleSheet.cssText=e&#125;t.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>].appendChild(a)&#125;<span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">"rgb("</span>+~~(<span class="number">255</span>*<span class="built_in">Math</span>.random())+<span class="string">","</span>+~~(<span class="number">255</span>*<span class="built_in">Math</span>.random())+<span class="string">","</span>+~~(<span class="number">255</span>*<span class="built_in">Math</span>.random())+<span class="string">")"</span>&#125;<span class="keyword">var</span> d=[];e.requestAnimationFrame=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;setTimeout(e,<span class="number">1e3</span>/<span class="number">60</span>)&#125;&#125;(),n()&#125;(<span class="built_in">window</span>,<span class="built_in">document</span>);</span><br></pre></td></tr></table></figure><p>在 \themes\layout\layout.ejs 文件末尾添加以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面点击小红心 --&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/js/love.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>再次加载页面我们就可以看到点击爱心的特效了<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E7%82%B9%E5%87%BB%E7%88%B1%E5%BF%83%E7%89%B9%E6%95%88.png" alt="点击爱心特效"></p><h3 id="3-添加鼠标点击显示字体效果"><a href="#3-添加鼠标点击显示字体效果" class="headerlink" title="3.添加鼠标点击显示字体效果"></a>3.添加鼠标点击显示字体效果</h3><p>在 \themes\source\js 下新建文件 click_show_text.js，在 click_show_text.js 文件中添加以下代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 鼠标点击特效，文字特效</span></span><br><span class="line"><span class="keyword">var</span> a_idx = <span class="number">0</span>;</span><br><span class="line">jQuery(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"body"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span></span><br><span class="line">        (<span class="string">"富强"</span>, <span class="string">"民主"</span>, <span class="string">"文明"</span>, <span class="string">"和谐"</span>, <span class="string">"自由"</span>, <span class="string">"平等"</span>, <span class="string">"公正"</span>, <span class="string">"法治"</span>, <span class="string">"爱国"</span>, <span class="string">"敬业"</span>, <span class="string">"诚信"</span>, <span class="string">"友善"</span>);</span><br><span class="line">        <span class="keyword">var</span> $i = $(<span class="string">"&lt;span/&gt;"</span>).text(a[a_idx]);</span><br><span class="line">        a_idx = (a_idx + <span class="number">1</span>) % a.length;</span><br><span class="line">        <span class="keyword">var</span> x = e.pageX,</span><br><span class="line">        y = e.pageY;</span><br><span class="line">        $i.css(&#123;</span><br><span class="line">            <span class="string">"z-index"</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="string">"top"</span>: y - <span class="number">20</span>,</span><br><span class="line">            <span class="string">"left"</span>: x,</span><br><span class="line">            <span class="string">"position"</span>: <span class="string">"absolute"</span>,</span><br><span class="line">            <span class="string">"font-weight"</span>: <span class="string">"bold"</span>,</span><br><span class="line">            <span class="string">"color"</span>: <span class="string">"#FF0000"</span></span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="string">"body"</span>).append($i);</span><br><span class="line">        $i.animate(&#123;</span><br><span class="line">            <span class="string">"top"</span>: y - <span class="number">180</span>,</span><br><span class="line">            <span class="string">"opacity"</span>: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="number">3000</span>,</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          $i.remove();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    setTimeout(<span class="string">'delay()'</span>, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">".buryit"</span>).removeAttr(<span class="string">"onclick"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以根据自己喜欢然后替换为其他文字</p><p>如果想要每次点击显示的文字为不同颜色，可以将其中 color 值进行如下更改：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"color"</span>: <span class="string">"rgb("</span> + ~~(<span class="number">255</span> * <span class="built_in">Math</span>.random()) + <span class="string">","</span> + ~~(<span class="number">255</span> * <span class="built_in">Math</span>.random()) + <span class="string">","</span> + ~~(<span class="number">255</span> * <span class="built_in">Math</span>.random()) + <span class="string">")"</span></span><br></pre></td></tr></table></figure><p>然后在 \themes\layout\layout.ejs 文件末尾添加以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--单击显示文字--&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/js/click_show_text.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>当再次加载页面之后，就可以看到好看的字体特效了<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E5%AD%97%E4%BD%93%E7%89%B9%E6%95%88.png" alt="点击字体特效"></p><h3 id="4-添加鼠标点击烟花爆炸效果"><a href="#4-添加鼠标点击烟花爆炸效果" class="headerlink" title="4.添加鼠标点击烟花爆炸效果"></a>4.添加鼠标点击烟花爆炸效果</h3><p>在 \themes\source\js 目录下新建一个 fireworks.js 的文件，里面写入以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;<span class="function"><span class="keyword">function</span> <span class="title">updateCoords</span>(<span class="params">e</span>)</span>&#123;pointerX=(e.clientX||e.touches[<span class="number">0</span>].clientX)-canvasEl.getBoundingClientRect().left,pointerY=e.clientY||e.touches[<span class="number">0</span>].clientY-canvasEl.getBoundingClientRect().top&#125;<span class="function"><span class="keyword">function</span> <span class="title">setParticuleDirection</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">var</span> t=anime.random(<span class="number">0</span>,<span class="number">360</span>)*<span class="built_in">Math</span>.PI/<span class="number">180</span>,a=anime.random(<span class="number">50</span>,<span class="number">180</span>),n=[<span class="number">-1</span>,<span class="number">1</span>][anime.random(<span class="number">0</span>,<span class="number">1</span>)]*a;<span class="keyword">return</span>&#123;<span class="attr">x</span>:e.x+n*<span class="built_in">Math</span>.cos(t),<span class="attr">y</span>:e.y+n*<span class="built_in">Math</span>.sin(t)&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">createParticule</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a=&#123;&#125;;<span class="keyword">return</span> a.x=e,a.y=t,a.color=colors[anime.random(<span class="number">0</span>,colors.length<span class="number">-1</span>)],a.radius=anime.random(<span class="number">16</span>,<span class="number">32</span>),a.endPos=setParticuleDirection(a),a.draw=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">Math</span>.PI,!<span class="number">0</span>),ctx.fillStyle=a.color,ctx.fill()&#125;,a&#125;<span class="function"><span class="keyword">function</span> <span class="title">createCircle</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a=&#123;&#125;;<span class="keyword">return</span> a.x=e,a.y=t,a.color=<span class="string">"#F00"</span>,a.radius=<span class="number">0.1</span>,a.alpha=<span class="number">0.5</span>,a.lineWidth=<span class="number">6</span>,a.draw=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ctx.globalAlpha=a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">Math</span>.PI,!<span class="number">0</span>),ctx.lineWidth=a.lineWidth,ctx.strokeStyle=a.color,ctx.stroke(),ctx.globalAlpha=<span class="number">1</span>&#125;,a&#125;<span class="function"><span class="keyword">function</span> <span class="title">renderParticule</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> t=<span class="number">0</span>;t&lt;e.animatables.length;t++)&#123;e.animatables[t].target.draw()&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">animateParticules</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=createCircle(e,t),n=[],i=<span class="number">0</span>;i&lt;numberOfParticules;i++)&#123;n.push(createParticule(e,t))&#125;anime.timeline().add(&#123;<span class="attr">targets</span>:n,<span class="attr">x</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">return</span> e.endPos.x&#125;,<span class="attr">y</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">return</span> e.endPos.y&#125;,<span class="attr">radius</span>:<span class="number">0.1</span>,<span class="attr">duration</span>:anime.random(<span class="number">1200</span>,<span class="number">1800</span>),<span class="attr">easing</span>:<span class="string">"easeOutExpo"</span>,<span class="attr">update</span>:renderParticule&#125;).add(&#123;<span class="attr">targets</span>:a,<span class="attr">radius</span>:anime.random(<span class="number">80</span>,<span class="number">160</span>),<span class="attr">lineWidth</span>:<span class="number">0</span>,<span class="attr">alpha</span>:&#123;<span class="attr">value</span>:<span class="number">0</span>,<span class="attr">easing</span>:<span class="string">"linear"</span>,<span class="attr">duration</span>:anime.random(<span class="number">600</span>,<span class="number">800</span>)&#125;,<span class="attr">duration</span>:anime.random(<span class="number">1200</span>,<span class="number">1800</span>),<span class="attr">easing</span>:<span class="string">"easeOutExpo"</span>,<span class="attr">update</span>:renderParticule,<span class="attr">offset</span>:<span class="number">0</span>&#125;)&#125;<span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> n=<span class="keyword">this</span>,i=<span class="built_in">arguments</span>;clearTimeout(a),a=setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;e.apply(n,i)&#125;,t)&#125;&#125;<span class="keyword">var</span> canvasEl=<span class="built_in">document</span>.querySelector(<span class="string">".fireworks"</span>);<span class="keyword">if</span>(canvasEl)&#123;<span class="keyword">var</span> ctx=canvasEl.getContext(<span class="string">"2d"</span>),numberOfParticules=<span class="number">30</span>,pointerX=<span class="number">0</span>,pointerY=<span class="number">0</span>,tap=<span class="string">"mousedown"</span>,colors=[<span class="string">"#FF1461"</span>,<span class="string">"#18FF92"</span>,<span class="string">"#5A87FF"</span>,<span class="string">"#FBF38C"</span>],setCanvasSize=debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;canvasEl.width=<span class="number">2</span>*<span class="built_in">window</span>.innerWidth,canvasEl.height=<span class="number">2</span>*<span class="built_in">window</span>.innerHeight,canvasEl.style.width=<span class="built_in">window</span>.innerWidth+<span class="string">"px"</span>,canvasEl.style.height=<span class="built_in">window</span>.innerHeight+<span class="string">"px"</span>,canvasEl.getContext(<span class="string">"2d"</span>).scale(<span class="number">2</span>,<span class="number">2</span>)&#125;,<span class="number">500</span>),render=anime(&#123;<span class="attr">duration</span>:<span class="number">1</span>/<span class="number">0</span>,<span class="attr">update</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,canvasEl.width,canvasEl.height)&#125;&#125;);<span class="built_in">document</span>.addEventListener(tap,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="string">"sidebar"</span>!==e.target.id&amp;&amp;<span class="string">"toggle-sidebar"</span>!==e.target.id&amp;&amp;<span class="string">"A"</span>!==e.target.nodeName&amp;&amp;<span class="string">"IMG"</span>!==e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))&#125;,!<span class="number">1</span>),setCanvasSize(),<span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>,setCanvasSize,!<span class="number">1</span>)&#125;<span class="string">"use strict"</span>;<span class="function"><span class="keyword">function</span> <span class="title">updateCoords</span>(<span class="params">e</span>)</span>&#123;pointerX=(e.clientX||e.touches[<span class="number">0</span>].clientX)-canvasEl.getBoundingClientRect().left,pointerY=e.clientY||e.touches[<span class="number">0</span>].clientY-canvasEl.getBoundingClientRect().top&#125;<span class="function"><span class="keyword">function</span> <span class="title">setParticuleDirection</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">var</span> t=anime.random(<span class="number">0</span>,<span class="number">360</span>)*<span class="built_in">Math</span>.PI/<span class="number">180</span>,a=anime.random(<span class="number">50</span>,<span class="number">180</span>),n=[<span class="number">-1</span>,<span class="number">1</span>][anime.random(<span class="number">0</span>,<span class="number">1</span>)]*a;<span class="keyword">return</span>&#123;<span class="attr">x</span>:e.x+n*<span class="built_in">Math</span>.cos(t),<span class="attr">y</span>:e.y+n*<span class="built_in">Math</span>.sin(t)&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">createParticule</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a=&#123;&#125;;<span class="keyword">return</span> a.x=e,a.y=t,a.color=colors[anime.random(<span class="number">0</span>,colors.length<span class="number">-1</span>)],a.radius=anime.random(<span class="number">16</span>,<span class="number">32</span>),a.endPos=setParticuleDirection(a),a.draw=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">Math</span>.PI,!<span class="number">0</span>),ctx.fillStyle=a.color,ctx.fill()&#125;,a&#125;<span class="function"><span class="keyword">function</span> <span class="title">createCircle</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a=&#123;&#125;;<span class="keyword">return</span> a.x=e,a.y=t,a.color=<span class="string">"#F00"</span>,a.radius=<span class="number">0.1</span>,a.alpha=<span class="number">0.5</span>,a.lineWidth=<span class="number">6</span>,a.draw=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ctx.globalAlpha=a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">Math</span>.PI,!<span class="number">0</span>),ctx.lineWidth=a.lineWidth,ctx.strokeStyle=a.color,ctx.stroke(),ctx.globalAlpha=<span class="number">1</span>&#125;,a&#125;<span class="function"><span class="keyword">function</span> <span class="title">renderParticule</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> t=<span class="number">0</span>;t&lt;e.animatables.length;t++)&#123;e.animatables[t].target.draw()&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">animateParticules</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=createCircle(e,t),n=[],i=<span class="number">0</span>;i&lt;numberOfParticules;i++)&#123;n.push(createParticule(e,t))&#125;anime.timeline().add(&#123;<span class="attr">targets</span>:n,<span class="attr">x</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">return</span> e.endPos.x&#125;,<span class="attr">y</span>:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">return</span> e.endPos.y&#125;,<span class="attr">radius</span>:<span class="number">0.1</span>,<span class="attr">duration</span>:anime.random(<span class="number">1200</span>,<span class="number">1800</span>),<span class="attr">easing</span>:<span class="string">"easeOutExpo"</span>,<span class="attr">update</span>:renderParticule&#125;).add(&#123;<span class="attr">targets</span>:a,<span class="attr">radius</span>:anime.random(<span class="number">80</span>,<span class="number">160</span>),<span class="attr">lineWidth</span>:<span class="number">0</span>,<span class="attr">alpha</span>:&#123;<span class="attr">value</span>:<span class="number">0</span>,<span class="attr">easing</span>:<span class="string">"linear"</span>,<span class="attr">duration</span>:anime.random(<span class="number">600</span>,<span class="number">800</span>)&#125;,<span class="attr">duration</span>:anime.random(<span class="number">1200</span>,<span class="number">1800</span>),<span class="attr">easing</span>:<span class="string">"easeOutExpo"</span>,<span class="attr">update</span>:renderParticule,<span class="attr">offset</span>:<span class="number">0</span>&#125;)&#125;<span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">e,t</span>)</span>&#123;<span class="keyword">var</span> a;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> n=<span class="keyword">this</span>,i=<span class="built_in">arguments</span>;clearTimeout(a),a=setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;e.apply(n,i)&#125;,t)&#125;&#125;<span class="keyword">var</span> canvasEl=<span class="built_in">document</span>.querySelector(<span class="string">".fireworks"</span>);<span class="keyword">if</span>(canvasEl)&#123;<span class="keyword">var</span> ctx=canvasEl.getContext(<span class="string">"2d"</span>),numberOfParticules=<span class="number">30</span>,pointerX=<span class="number">0</span>,pointerY=<span class="number">0</span>,tap=<span class="string">"mousedown"</span>,colors=[<span class="string">"#FF1461"</span>,<span class="string">"#18FF92"</span>,<span class="string">"#5A87FF"</span>,<span class="string">"#FBF38C"</span>],setCanvasSize=debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;canvasEl.width=<span class="number">2</span>*<span class="built_in">window</span>.innerWidth,canvasEl.height=<span class="number">2</span>*<span class="built_in">window</span>.innerHeight,canvasEl.style.width=<span class="built_in">window</span>.innerWidth+<span class="string">"px"</span>,canvasEl.style.height=<span class="built_in">window</span>.innerHeight+<span class="string">"px"</span>,canvasEl.getContext(<span class="string">"2d"</span>).scale(<span class="number">2</span>,<span class="number">2</span>)&#125;,<span class="number">500</span>),render=anime(&#123;<span class="attr">duration</span>:<span class="number">1</span>/<span class="number">0</span>,<span class="attr">update</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,canvasEl.width,canvasEl.height)&#125;&#125;);<span class="built_in">document</span>.addEventListener(tap,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="string">"sidebar"</span>!==e.target.id&amp;&amp;<span class="string">"toggle-sidebar"</span>!==e.target.id&amp;&amp;<span class="string">"A"</span>!==e.target.nodeName&amp;&amp;<span class="string">"IMG"</span>!==e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))&#125;,!<span class="number">1</span>),setCanvasSize(),<span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>,setCanvasSize,!<span class="number">1</span>)&#125;;</span><br></pre></td></tr></table></figure><p>然后在 \themes\layout\layout.ejs 文件中写入以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas <span class="class"><span class="keyword">class</span></span>=<span class="string">"fireworks"</span> style=<span class="string">"position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"</span> &gt;&lt;<span class="regexp">/canvas&gt; </span></span><br><span class="line"><span class="regexp">&lt;script type="text/</span>javascript<span class="string">" src="</span><span class="comment">//cdn.bootcss.com/animejs/2.2.0/anime.min.js"&gt;&lt;/script&gt; </span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/js/fireworks.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>再次加载页面之后，我们的网站就有鼠标点击烟花爆炸效果了<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E7%82%B9%E5%87%BB%E7%88%86%E7%82%B8%E6%95%88%E6%9E%9C.png" alt="鼠标点击爆炸效果"></p><h3 id="5-添加彩色滚动变换字体"><a href="#5-添加彩色滚动变换字体" class="headerlink" title="5.添加彩色滚动变换字体"></a>5.添加彩色滚动变换字体</h3><p>在你想要添加彩色滚动变换字体的地方写入以下代码即可，其中文字可自行更改：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"binft"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var binft = function (r) &#123;</span></span><br><span class="line"><span class="regexp">      function t() &#123;</span></span><br><span class="line"><span class="regexp">        return b[Math.floor(Math.random() * b.length)]</span></span><br><span class="line"><span class="regexp">      &#125;  </span></span><br><span class="line"><span class="regexp">      function e() &#123;</span></span><br><span class="line"><span class="regexp">        return String.fromCharCode(94 * Math.random() + 33)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      function n(r) &#123;</span></span><br><span class="line"><span class="regexp">        for (var n = document.createDocumentFragment(), i = 0; r &gt; i; i++) &#123;</span></span><br><span class="line"><span class="regexp">          var l = document.createElement("span");</span></span><br><span class="line"><span class="regexp">          l.textContent = e(), l.style.color = t(), n.appendChild(l)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        return n</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      function i() &#123;</span></span><br><span class="line"><span class="regexp">        var t = o[c.skillI];</span></span><br><span class="line"><span class="regexp">        c.step ? c.step-- : (c.step = g, c.prefixP &lt; l.length ? (c.prefixP &gt;= 0 &amp;&amp; (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP &lt; t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP &gt; 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP &lt; l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      var l = "",</span></span><br><span class="line"><span class="regexp">      o = ["青青陵上柏，磊磊涧中石。", "人生天地间，忽如远行客。","斗酒相娱乐，聊厚不为薄。", "驱车策驽马，游戏宛与洛。","洛中何郁郁，冠带自相索。","长衢罗夹巷，王侯多第宅。","两宫遥相望，双阙百余尺。","极宴娱心意，戚戚何所迫？"].map(function (r) &#123;</span></span><br><span class="line"><span class="regexp">      return r + ""</span></span><br><span class="line"><span class="regexp">      &#125;),</span></span><br><span class="line"><span class="regexp">      a = 2,</span></span><br><span class="line"><span class="regexp">      g = 1,</span></span><br><span class="line"><span class="regexp">      s = 5,</span></span><br><span class="line"><span class="regexp">      d = 75,</span></span><br><span class="line"><span class="regexp">      b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"],</span></span><br><span class="line"><span class="regexp">      c = &#123;</span></span><br><span class="line"><span class="regexp">        text: "",</span></span><br><span class="line"><span class="regexp">        prefixP: -s,</span></span><br><span class="line"><span class="regexp">        skillI: 0,</span></span><br><span class="line"><span class="regexp">        skillP: 0,</span></span><br><span class="line"><span class="regexp">        direction: "forward",</span></span><br><span class="line"><span class="regexp">        delay: a,</span></span><br><span class="line"><span class="regexp">        step: g</span></span><br><span class="line"><span class="regexp">      &#125;;</span></span><br><span class="line"><span class="regexp">      i()</span></span><br><span class="line"><span class="regexp">      &#125;;</span></span><br><span class="line"><span class="regexp">      binft(document.getElementById('binft'));</span></span><br><span class="line"><span class="regexp">  &lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>加载页面最终显示效果为：<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E5%BD%A9%E8%89%B2%E6%BB%9A%E5%8A%A8%E5%8F%98%E6%8D%A2%E5%AD%97%E4%BD%93.gif" alt="彩色滚动变换字体"></p><h3 id="6-添加网站运行时间"><a href="#6-添加网站运行时间" class="headerlink" title="6.添加网站运行时间"></a>6.添加网站运行时间</h3><p>一个比较好的小功能，可以看见自己的博客运行多久了，时间一天天的增加，成就感也会一天天增加的<br>在 \themes\layout_partial\footer.ejs 文件下添加以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;span id=<span class="string">"timeDate"</span>&gt;载入天数...&lt;<span class="regexp">/span&gt;&lt;span id="times"&gt;载入时分秒...&lt;/</span>span&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(); </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createtime</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">var</span> grt= <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"08/10/2018 17:38:00"</span>);<span class="comment">//在此处修改你的建站时间，格式：月/日/年 时:分:秒</span></span><br><span class="line">        now.setTime(now.getTime()+<span class="number">250</span>); </span><br><span class="line">        days = (now - grt ) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>; dnum = <span class="built_in">Math</span>.floor(days); </span><br><span class="line">        hours = (now - grt ) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> - (<span class="number">24</span> * dnum); hnum = <span class="built_in">Math</span>.floor(hours); </span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">String</span>(hnum).length ==<span class="number">1</span> )&#123;hnum = <span class="string">"0"</span> + hnum;&#125; minutes = (now - grt ) / <span class="number">1000</span> /<span class="number">60</span> - (<span class="number">24</span> * <span class="number">60</span> * dnum) - (<span class="number">60</span> * hnum); </span><br><span class="line">        mnum = <span class="built_in">Math</span>.floor(minutes); <span class="keyword">if</span>(<span class="built_in">String</span>(mnum).length ==<span class="number">1</span> )&#123;mnum = <span class="string">"0"</span> + mnum;&#125; </span><br><span class="line">        seconds = (now - grt ) / <span class="number">1000</span> - (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * dnum) - (<span class="number">60</span> * <span class="number">60</span> * hnum) - (<span class="number">60</span> * mnum); </span><br><span class="line">        snum = <span class="built_in">Math</span>.round(seconds); <span class="keyword">if</span>(<span class="built_in">String</span>(snum).length ==<span class="number">1</span> )&#123;snum = <span class="string">"0"</span> + snum;&#125; </span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"timeDate"</span>).innerHTML = <span class="string">"本站已安全运行 "</span>+dnum+<span class="string">" 天 "</span>; </span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"times"</span>).innerHTML = hnum + <span class="string">" 小时 "</span> + mnum + <span class="string">" 分 "</span> + snum + <span class="string">" 秒"</span>; </span><br><span class="line">    &#125; </span><br><span class="line">setInterval(<span class="string">"createtime()"</span>,<span class="number">250</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>加载页面，展示效果如下：<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E5%A4%A9%E6%95%B0.png" alt="网站运行天数"></p><h3 id="7-浏览器网页标题恶搞"><a href="#7-浏览器网页标题恶搞" class="headerlink" title="7.浏览器网页标题恶搞"></a>7.浏览器网页标题恶搞</h3><p>当用户访问你的博客时点击到了其他网页，我们可以恶搞一下网页标题，呼唤用户回来，首先在目录 \themes\source\js 下新建一个 FunnyTitle.js 文件，在里面填写如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器搞笑标题</span></span><br><span class="line"><span class="keyword">var</span> OriginTitle = <span class="built_in">document</span>.title;</span><br><span class="line"><span class="keyword">var</span> titleTime;</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'visibilitychange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.hidden) &#123;</span><br><span class="line">        $(<span class="string">'[rel="icon"]'</span>).attr(<span class="string">'href'</span>, <span class="string">"/funny.ico"</span>);</span><br><span class="line">        <span class="built_in">document</span>.title = <span class="string">'╭(°A°`)╮ 页面崩溃啦 ~'</span>;</span><br><span class="line">        clearTimeout(titleTime);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="string">'[rel="icon"]'</span>).attr(<span class="string">'href'</span>, <span class="string">"/favicon.ico"</span>);</span><br><span class="line">        <span class="built_in">document</span>.title = <span class="string">'(ฅ&gt;ω&lt;*ฅ) 噫又好啦 ~'</span> + OriginTitle;</span><br><span class="line">        titleTime = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.title = OriginTitle;</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中 funny.ico 是用户切换到其他标签后你网站的图标，favicon.ico 是正常图标，然后在 \themes\layout\layout.ejs 文件中添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--浏览器搞笑标题--&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"/js/FunnyTitle.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>当我们在再次重新加载页面就可以看到:<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E6%A0%87%E9%A2%98%E6%81%B6%E6%90%9E.png" alt="浏览器恶搞标题"></p><h3 id="8-背景添加动态线条效果"><a href="#8-背景添加动态线条效果" class="headerlink" title="8.背景添加动态线条效果"></a>8.背景添加动态线条效果</h3><p>在 \themes\layout\layout.ejs 文件中添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--动态线条背景--&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span></span><br><span class="line">color=<span class="string">"220,220,220"</span> opacity=<span class="string">'0.7'</span> zIndex=<span class="string">"-2"</span> count=<span class="string">"200"</span> src=<span class="string">"//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>其中：<br>color：表示线条颜色，三个数字分别为(R,G,B)，默认：（0,0,0）<br>opacity：表示线条透明度（0~1），默认：0.5<br>count：表示线条的总数量，默认：150<br>zIndex：表示背景的z-index属性，css属性用于控制所在层的位置，默认：-1</p><p>加载页面，展示效果如下：<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E8%83%8C%E6%99%AF%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E7%BA%BF%E6%9D%A1%E6%95%88%E6%9E%9C.png" alt="添加动态线条效果"></p><h3 id="9-添加网站雪花飘落效果"><a href="#9-添加网站雪花飘落效果" class="headerlink" title="9.添加网站雪花飘落效果"></a>9.添加网站雪花飘落效果</h3><p>雪花飘落由两个样式，可以选择自己喜欢的样式<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E9%9B%AA%E8%8A%B1%E6%A0%B7%E5%BC%8F%E4%B8%80.png" alt="雪花效果样式一"><br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E9%9B%AA%E8%8A%B1%E6%A0%B7%E5%BC%8F%E4%BA%8C.png" alt="雪花效果样式二"></p><p>实现方法：在 \themes\source\js 目录下新建一个 snow.js 文件，粘贴以下代码：</p><figure class="highlight js"><figcaption><span>样式一</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*样式一*/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</span><br><span class="line">$.fn.snow = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> $flake = $(<span class="string">'&lt;div id="snowbox" /&gt;'</span>).css(&#123;<span class="string">'position'</span>: <span class="string">'absolute'</span>,<span class="string">'z-index'</span>:<span class="string">'9999'</span>, <span class="string">'top'</span>: <span class="string">'-50px'</span>&#125;).html(<span class="string">'&amp;#10052;'</span>),</span><br><span class="line">documentHeight = $(<span class="built_in">document</span>).height(),</span><br><span class="line">documentWidth= $(<span class="built_in">document</span>).width(),</span><br><span class="line">defaults = &#123;</span><br><span class="line">minSize: <span class="number">10</span>,</span><br><span class="line">maxSize: <span class="number">20</span>,</span><br><span class="line">newOn: <span class="number">1000</span>,</span><br><span class="line">flakeColor: <span class="string">"#AFDAEF"</span> <span class="comment">/* 此处可以定义雪花颜色，若要白色可以改为#FFFFFF */</span></span><br><span class="line">&#125;,</span><br><span class="line">options= $.extend(&#123;&#125;, defaults, options);</span><br><span class="line"><span class="keyword">var</span> interval= setInterval( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> startPositionLeft = <span class="built_in">Math</span>.random() * documentWidth - <span class="number">100</span>,</span><br><span class="line">startOpacity = <span class="number">0.5</span> + <span class="built_in">Math</span>.random(),</span><br><span class="line">sizeFlake = options.minSize + <span class="built_in">Math</span>.random() * options.maxSize,</span><br><span class="line">endPositionTop = documentHeight - <span class="number">200</span>,</span><br><span class="line">endPositionLeft = startPositionLeft - <span class="number">500</span> + <span class="built_in">Math</span>.random() * <span class="number">500</span>,</span><br><span class="line">durationFall = documentHeight * <span class="number">10</span> + <span class="built_in">Math</span>.random() * <span class="number">5000</span>;</span><br><span class="line">$flake.clone().appendTo(<span class="string">'body'</span>).css(&#123;</span><br><span class="line">left: startPositionLeft,</span><br><span class="line">opacity: startOpacity,</span><br><span class="line"><span class="string">'font-size'</span>: sizeFlake,</span><br><span class="line">color: options.flakeColor</span><br><span class="line">&#125;).animate(&#123;</span><br><span class="line">top: endPositionTop,</span><br><span class="line">left: endPositionLeft,</span><br><span class="line">opacity: <span class="number">0.2</span></span><br><span class="line">&#125;,durationFall,<span class="string">'linear'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$(<span class="keyword">this</span>).remove()</span><br><span class="line">&#125;);</span><br><span class="line">&#125;, options.newOn);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)(jQuery);</span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.fn.snow(&#123; </span><br><span class="line">    minSize: <span class="number">5</span>, <span class="comment">/* 定义雪花最小尺寸 */</span></span><br><span class="line">    maxSize: <span class="number">50</span>,<span class="comment">/* 定义雪花最大尺寸 */</span></span><br><span class="line">    newOn: <span class="number">300</span>  <span class="comment">/* 定义密集程度，数字越小越密集 */</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>样式二</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*样式二*/</span></span><br><span class="line"><span class="comment">/* 控制下雪 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">snowFall</span>(<span class="params">snow</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* 可配置属性 */</span></span><br><span class="line">    snow = snow || &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.maxFlake = snow.maxFlake || <span class="number">200</span>;   <span class="comment">/* 最多片数 */</span></span><br><span class="line">    <span class="keyword">this</span>.flakeSize = snow.flakeSize || <span class="number">10</span>;  <span class="comment">/* 雪花形状 */</span></span><br><span class="line">    <span class="keyword">this</span>.fallSpeed = snow.fallSpeed || <span class="number">1</span>;   <span class="comment">/* 坠落速度 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 兼容写法 */</span></span><br><span class="line">requestAnimationFrame = <span class="built_in">window</span>.requestAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.mozRequestAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.webkitRequestAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.msRequestAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.oRequestAnimationFrame ||</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123; setTimeout(callback, <span class="number">1000</span> / <span class="number">60</span>); &#125;;</span><br><span class="line"></span><br><span class="line">cancelAnimationFrame = <span class="built_in">window</span>.cancelAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.mozCancelAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.webkitCancelAnimationFrame ||</span><br><span class="line">    <span class="built_in">window</span>.msCancelAnimationFrame ||</span><br><span class="line"><span class="built_in">window</span>.oCancelAnimationFrame;</span><br><span class="line"><span class="comment">/* 开始下雪 */</span></span><br><span class="line">snowFall.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">/* 创建画布 */</span></span><br><span class="line">    snowCanvas.apply(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">/* 创建雪花形状 */</span></span><br><span class="line">    createFlakes.apply(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">/* 画雪 */</span></span><br><span class="line">    drawSnow.apply(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 创建画布 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">snowCanvas</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* 添加Dom结点 */</span></span><br><span class="line">    <span class="keyword">var</span> snowcanvas = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>);</span><br><span class="line">    snowcanvas.id = <span class="string">"snowfall"</span>;</span><br><span class="line">    snowcanvas.width = <span class="built_in">window</span>.innerWidth;</span><br><span class="line">    snowcanvas.height = <span class="built_in">document</span>.body.clientHeight;</span><br><span class="line">    snowcanvas.setAttribute(<span class="string">"style"</span>, <span class="string">"position:absolute; top: 0; left: 0; z-index: 1; pointer-events: none;"</span>);</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">"body"</span>)[<span class="number">0</span>].appendChild(snowcanvas);</span><br><span class="line">    <span class="keyword">this</span>.canvas = snowcanvas;</span><br><span class="line">    <span class="keyword">this</span>.ctx = snowcanvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">    <span class="comment">/* 窗口大小改变的处理 */</span></span><br><span class="line">    <span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        snowcanvas.width = <span class="built_in">window</span>.innerWidth;</span><br><span class="line">        <span class="comment">/* snowcanvas.height = window.innerHeight */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 雪运动对象 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flakeMove</span>(<span class="params">canvasWidth, canvasHeight, flakeSize, fallSpeed</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * canvasWidth);   <span class="comment">/* x坐标 */</span></span><br><span class="line">    <span class="keyword">this</span>.y = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * canvasHeight);  <span class="comment">/* y坐标 */</span></span><br><span class="line">    <span class="keyword">this</span>.size = <span class="built_in">Math</span>.random() * flakeSize + <span class="number">2</span>;          <span class="comment">/* 形状 */</span></span><br><span class="line">    <span class="keyword">this</span>.maxSize = flakeSize;                           <span class="comment">/* 最大形状 */</span></span><br><span class="line">    <span class="keyword">this</span>.speed = <span class="built_in">Math</span>.random() * <span class="number">1</span> + fallSpeed;         <span class="comment">/* 坠落速度 */</span></span><br><span class="line">    <span class="keyword">this</span>.fallSpeed = fallSpeed;                         <span class="comment">/* 坠落速度 */</span></span><br><span class="line">    <span class="keyword">this</span>.velY = <span class="keyword">this</span>.speed;                             <span class="comment">/* Y方向速度 */</span></span><br><span class="line">    <span class="keyword">this</span>.velX = <span class="number">0</span>;                                      <span class="comment">/* X方向速度 */</span></span><br><span class="line">    <span class="keyword">this</span>.stepSize = <span class="built_in">Math</span>.random() / <span class="number">30</span>;                 <span class="comment">/* 步长 */</span></span><br><span class="line">    <span class="keyword">this</span>.step = <span class="number">0</span>                                       <span class="comment">/* 步数 */</span></span><br><span class="line">&#125;</span><br><span class="line">flakeMove.prototype.update = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="keyword">this</span>.x,</span><br><span class="line">        y = <span class="keyword">this</span>.y;</span><br><span class="line">    <span class="comment">/* 左右摆动(余弦) */</span></span><br><span class="line">    <span class="keyword">this</span>.velX *= <span class="number">0.98</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.velY &lt;= <span class="keyword">this</span>.speed) &#123;</span><br><span class="line">        <span class="keyword">this</span>.velY = <span class="keyword">this</span>.speed</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.velX += <span class="built_in">Math</span>.cos(<span class="keyword">this</span>.step += <span class="number">.05</span>) * <span class="keyword">this</span>.stepSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.y += <span class="keyword">this</span>.velY;</span><br><span class="line">    <span class="keyword">this</span>.x += <span class="keyword">this</span>.velX;</span><br><span class="line">    <span class="comment">/* 飞出边界的处理 */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.x &gt;= canvas.width || <span class="keyword">this</span>.x &lt;= <span class="number">0</span> || <span class="keyword">this</span>.y &gt;= canvas.height || <span class="keyword">this</span>.y &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.reset(canvas.width, canvas.height)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 飞出边界-放置最顶端继续坠落 */</span></span><br><span class="line">flakeMove.prototype.reset = <span class="function"><span class="keyword">function</span>(<span class="params">width, height</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * width);</span><br><span class="line">    <span class="keyword">this</span>.y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.size = <span class="built_in">Math</span>.random() * <span class="keyword">this</span>.maxSize + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">this</span>.speed = <span class="built_in">Math</span>.random() * <span class="number">1</span> + <span class="keyword">this</span>.fallSpeed;</span><br><span class="line">    <span class="keyword">this</span>.velY = <span class="keyword">this</span>.speed;</span><br><span class="line">    <span class="keyword">this</span>.velX = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 渲染雪花-随机形状（此处可修改雪花颜色！！！）</span></span><br><span class="line">flakeMove.prototype.render = <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> snowFlake = ctx.createRadialGradient(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y, <span class="number">0</span>, <span class="keyword">this</span>.x, <span class="keyword">this</span>.y, <span class="keyword">this</span>.size);</span><br><span class="line">    snowFlake.addColorStop(<span class="number">0</span>, <span class="string">"rgba(255, 255, 255, 0.9)"</span>);  <span class="comment">/* 此处是雪花颜色，默认是白色 */</span></span><br><span class="line">    snowFlake.addColorStop(<span class="number">.5</span>, <span class="string">"rgba(255, 255, 255, 0.5)"</span>); <span class="comment">/* 若要改为其他颜色，请自行查 */</span></span><br><span class="line">    snowFlake.addColorStop(<span class="number">1</span>, <span class="string">"rgba(255, 255, 255, 0)"</span>);    <span class="comment">/* 找16进制的RGB 颜色代码。 */</span></span><br><span class="line">    ctx.save();</span><br><span class="line">    ctx.fillStyle = snowFlake;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.arc(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y, <span class="keyword">this</span>.size, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>);</span><br><span class="line">    ctx.fill();</span><br><span class="line">    ctx.restore();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 创建雪花-定义形状 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFlakes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> maxFlake = <span class="keyword">this</span>.maxFlake,</span><br><span class="line">        flakes = <span class="keyword">this</span>.flakes = [],</span><br><span class="line">        canvas = <span class="keyword">this</span>.canvas;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; maxFlake; i++) &#123;</span><br><span class="line">        flakes.push(<span class="keyword">new</span> flakeMove(canvas.width, canvas.height, <span class="keyword">this</span>.flakeSize, <span class="keyword">this</span>.fallSpeed))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 画雪 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSnow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> maxFlake = <span class="keyword">this</span>.maxFlake,</span><br><span class="line">        flakes = <span class="keyword">this</span>.flakes;</span><br><span class="line">    ctx = <span class="keyword">this</span>.ctx, canvas = <span class="keyword">this</span>.canvas, that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">/* 清空雪花 */</span></span><br><span class="line">    ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="number">0</span>; e &lt; maxFlake; e++) &#123;</span><br><span class="line">        flakes[e].update();</span><br><span class="line">        flakes[e].render(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*  一帧一帧的画 */</span></span><br><span class="line">    <span class="keyword">this</span>.loop = requestAnimationFrame(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        drawSnow.apply(that);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 调用及控制方法 */</span></span><br><span class="line"><span class="keyword">var</span> snow = <span class="keyword">new</span> snowFall(&#123;<span class="attr">maxFlake</span>:<span class="number">60</span>&#125;);</span><br><span class="line">snow.start();</span><br></pre></td></tr></table></figure><p>然后在 \themes\layout\layout.ejs 文件里引用即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 雪花特效 --&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"\js\snow.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>如果没效果，请确认网页是否已载入JQurey，如果没有请在下雪代码之前引入JQ即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"http://libs.baidu.com/jquery/1.8.3/jquery.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type="text/</span>javascript<span class="string">" src="</span>http:<span class="comment">//libs.baidu.com/jquery/1.8.3/jquery.min.js"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://ihuan.me/2172.html" target="_blank" rel="noopener">《分享两种圣诞节雪花特效JS代码(网站下雪效果)》</a></p><h3 id="10-添加背景代码雨特效"><a href="#10-添加背景代码雨特效" class="headerlink" title="10.添加背景代码雨特效"></a>10.添加背景代码雨特效</h3><p>在 \themes\source\js 目录下新建一个 DigitalRain.js 的文件，里面写入以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//获取画布对象</span></span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</span><br><span class="line">    <span class="comment">//获取画布的上下文</span></span><br><span class="line">    <span class="keyword">var</span> context =canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">window</span>.screen;</span><br><span class="line">    <span class="keyword">var</span> W = canvas.width = s.width;</span><br><span class="line">    <span class="keyword">var</span> H = canvas.height;</span><br><span class="line">    <span class="comment">//获取浏览器屏幕的宽度和高度</span></span><br><span class="line">    <span class="comment">//var W = window.innerWidth;</span></span><br><span class="line">    <span class="comment">//var H = window.innerHeight;</span></span><br><span class="line">    <span class="comment">//设置canvas的宽度和高度</span></span><br><span class="line">    canvas.width = W;</span><br><span class="line">    canvas.height = H;</span><br><span class="line">    <span class="comment">//每个文字的字体大小</span></span><br><span class="line">    <span class="keyword">var</span> fontSize = <span class="number">12</span>;</span><br><span class="line">    <span class="comment">//计算列</span></span><br><span class="line">    <span class="keyword">var</span> colunms = <span class="built_in">Math</span>.floor(W /fontSize);</span><br><span class="line">    <span class="comment">//记录每列文字的y轴坐标</span></span><br><span class="line">    <span class="keyword">var</span> drops = [];</span><br><span class="line">    <span class="comment">//给每一个文字初始化一个起始点的位置</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;colunms;i++)&#123;</span><br><span class="line">        drops.push(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//运动的文字</span></span><br><span class="line">    <span class="keyword">var</span> str =<span class="string">"WELCOME TO WWW.ITRHX.COM"</span>;</span><br><span class="line">    <span class="comment">//4:fillText(str,x,y);原理就是去更改y的坐标位置</span></span><br><span class="line">    <span class="comment">//绘画的函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        context.fillStyle = <span class="string">"rgba(238,238,238,.08)"</span>;<span class="comment">//遮盖层</span></span><br><span class="line">        context.fillRect(<span class="number">0</span>,<span class="number">0</span>,W,H);</span><br><span class="line">        <span class="comment">//给字体设置样式</span></span><br><span class="line">        context.font = <span class="string">"600 "</span>+fontSize+<span class="string">"px  Georgia"</span>;</span><br><span class="line">        <span class="comment">//给字体添加颜色</span></span><br><span class="line">        context.fillStyle = [<span class="string">"#33B5E5"</span>, <span class="string">"#0099CC"</span>, <span class="string">"#AA66CC"</span>, <span class="string">"#9933CC"</span>, <span class="string">"#99CC00"</span>, <span class="string">"#669900"</span>, <span class="string">"#FFBB33"</span>, <span class="string">"#FF8800"</span>, <span class="string">"#FF4444"</span>, <span class="string">"#CC0000"</span>][<span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">10</span>)];<span class="comment">//randColor();可以rgb,hsl, 标准色，十六进制颜色</span></span><br><span class="line">        <span class="comment">//写入画布中</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;colunms;i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> index = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * str.length);</span><br><span class="line">            <span class="keyword">var</span> x = i*fontSize;</span><br><span class="line">            <span class="keyword">var</span> y = drops[i] *fontSize;</span><br><span class="line">            context.fillText(str[index],x,y);</span><br><span class="line">            <span class="comment">//如果要改变时间，肯定就是改变每次他的起点</span></span><br><span class="line">            <span class="keyword">if</span>(y &gt;= canvas.height &amp;&amp; <span class="built_in">Math</span>.random() &gt; <span class="number">0.99</span>)&#123;</span><br><span class="line">                drops[i] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            drops[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">randColor</span>(<span class="params"></span>)</span>&#123;<span class="comment">//随机颜色</span></span><br><span class="line">        <span class="keyword">var</span> r = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">        <span class="keyword">var</span> g = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"rgb("</span>+r+<span class="string">","</span>+g+<span class="string">","</span>+b+<span class="string">")"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    draw();</span><br><span class="line">    setInterval(draw,<span class="number">35</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在主题文件的相关css文件中（在\themes\source\less_main.less 文件末尾）添加以下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">canvas</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在\themes\layout\layout.ejs 文件中写入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 数字雨 --&gt;</span><br><span class="line">&lt;canvas id=<span class="string">"canvas"</span> width=<span class="string">"1440"</span> height=<span class="string">"900"</span> &gt;&lt;<span class="regexp">/canvas&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type="text/</span>javascript<span class="string">" src="</span>/js/DigitalRain.js<span class="string">"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>最终效果<br><img src="/img/hexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/%E8%83%8C%E6%99%AF%E4%BB%A3%E7%A0%81%E9%9B%A8.png" alt="背景代码雨"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文讲述的是添加博客美化的样式&lt;br&gt;请注意：不同主题可能方法有些不同，相同主题不同版本，配置方法也有所差异！&lt;/p&gt;
&lt;p&gt;博客美化前提条件：有一定的前端基础，了解 HTML、CSS、JS，了解 CSS 预处理语言 Sass、Less、Stylus，搞懂 hexo 的目录结构。&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="https://wzh3683.github.io/hexo_blog/categories/hexo/"/>
    
    
      <category term="hexo" scheme="https://wzh3683.github.io/hexo_blog/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>&#39;结合js做md5加密&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/16/%E7%BB%93%E5%90%88js%E5%81%9Amd5%E5%8A%A0%E5%AF%86/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/16/%E7%BB%93%E5%90%88js%E5%81%9Amd5%E5%8A%A0%E5%AF%86/</id>
    <published>2020-06-16T09:48:47.000Z</published>
    <updated>2020-06-20T10:29:37.800Z</updated>
    
    <content type="html"><![CDATA[<p>不管在前端还是后端，我们都会有一些简单的业务对数据进行加密处理，用来防止信息等被盗取，所以我们这里来使用md5加密。</p><h3 id="关于md5加密算法"><a href="#关于md5加密算法" class="headerlink" title="关于md5加密算法"></a>关于md5加密算法</h3><p>MD5信息摘要算法（英语：MD5 Message-Digest Algorithm），一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。MD5由美国密码学家罗纳德·李维斯特（Ronald Linn Rivest）设计，于1992年公开，用以取代MD4算法。这套算法的程序在 RFC 1321 标准中被加以规范。1996年后该算法被证实存在弱点，可以被加以破解，对于需要高度安全性的数据，专家一般建议改用其他算法，如SHA-2。2004年，证实MD5算法无法防止碰撞（collision），因此不适用于安全性认证，如SSL公开密钥认证或是数字签名等用途。</p><a id="more"></a><h3 id="md5依赖库"><a href="#md5依赖库" class="headerlink" title="md5依赖库"></a>md5依赖库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install js-md5</span><br><span class="line"></span><br><span class="line"><span class="comment"># "js-md5": "^0.7.3",</span></span><br></pre></td></tr></table></figure><p>针对md5加密库，因为他不是热库，不需要经常被使用，所以不需要将它加入到main.js中。最好的结果是每次使用单独对他进行调用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">'js-md5'</span></span><br></pre></td></tr></table></figure><h3 id="前端代码示例"><a href="#前端代码示例" class="headerlink" title="前端代码示例"></a>前端代码示例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;&#123;total&#125;&#125;</span><br><span class="line">    <span class="comment">&lt;!-- 7b7a53e239400a13bd6be6c91c4f6c4e --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">'js-md5'</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        total:<span class="string">''</span>,</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="actionscript">  <span class="comment">//注册组件标签</span></span></span><br><span class="line">  components:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="actionscript">  mounted:<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> num = <span class="string">'2020'</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.total = md5(num)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打印结果:7b7a53e239400a13bd6be6c91c4f6c4e</p><h3 id="后端代码示例"><a href="#后端代码示例" class="headerlink" title="后端代码示例"></a>后端代码示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment">#前端num</span></span><br><span class="line">num = <span class="string">'2020'</span></span><br><span class="line"><span class="comment">#前端传的sign</span></span><br><span class="line">sign = <span class="string">"7b7a53e239400a13bd6be6c91c4f6c4e"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例化</span></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line"><span class="comment">#组合要加密的字符串</span></span><br><span class="line">sign_str = num</span><br><span class="line"><span class="comment">#解码</span></span><br><span class="line">mysign = str(sign_str).encode(encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment">#设置加密</span></span><br><span class="line">md5.update(mysign)</span><br><span class="line">mysign = md5.hexdigest()</span><br><span class="line"><span class="comment">#判断</span></span><br><span class="line">print(mysign)</span><br><span class="line"><span class="keyword">if</span> sign == mysign:</span><br><span class="line">print(<span class="string">"签名一致"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">"数据被篡改"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印结果：7b7a53e239400a13bd6be6c91c4f6c4e</span></span><br><span class="line"><span class="comment">#签名一致</span></span><br></pre></td></tr></table></figure><p>针对需要保密的信息，使用md5进行加密一下简直不要太完美。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不管在前端还是后端，我们都会有一些简单的业务对数据进行加密处理，用来防止信息等被盗取，所以我们这里来使用md5加密。&lt;/p&gt;
&lt;h3 id=&quot;关于md5加密算法&quot;&gt;&lt;a href=&quot;#关于md5加密算法&quot; class=&quot;headerlink&quot; title=&quot;关于md5加密算法&quot;&gt;&lt;/a&gt;关于md5加密算法&lt;/h3&gt;&lt;p&gt;MD5信息摘要算法（英语：MD5 Message-Digest Algorithm），一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。MD5由美国密码学家罗纳德·李维斯特（Ronald Linn Rivest）设计，于1992年公开，用以取代MD4算法。这套算法的程序在 RFC 1321 标准中被加以规范。1996年后该算法被证实存在弱点，可以被加以破解，对于需要高度安全性的数据，专家一般建议改用其他算法，如SHA-2。2004年，证实MD5算法无法防止碰撞（collision），因此不适用于安全性认证，如SSL公开密钥认证或是数字签名等用途。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="vue" scheme="https://wzh3683.github.io/hexo_blog/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>&#39;结合python实现支付宝支付功能&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/16/%E7%BB%93%E5%90%88python%E5%AE%9E%E7%8E%B0%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98%E5%8A%9F%E8%83%BD/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/16/%E7%BB%93%E5%90%88python%E5%AE%9E%E7%8E%B0%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98%E5%8A%9F%E8%83%BD/</id>
    <published>2020-06-16T08:39:30.000Z</published>
    <updated>2020-06-20T09:59:06.685Z</updated>
    
    <content type="html"><![CDATA[<p>现在所有的门户网站还是一下应用，都离不开第三方支付，我们今天讲一下第三方的支付接口也就是支付宝接口付款。<br>支付宝支付采用了RSA加密签名的安全通信机制，开发者可以通过支付宝的公钥验证消息的来源，同时使用自己的私钥进行信息加密。RSA算法及数字签名机制是服务窗平台与开发者网关安全通信的基础。</p><a id="more"></a><h3 id="支付宝付款流程图"><a href="#支付宝付款流程图" class="headerlink" title="支付宝付款流程图"></a>支付宝付款流程图</h3><p><img src="/img/%E6%94%AF%E4%BB%98/%E6%94%AF%E4%BB%98%E5%AE%9D%E4%BB%98%E6%AC%BE%E9%80%BB%E8%BE%91.png" alt="使用支付宝付款流程图"></p><h3 id="沙箱"><a href="#沙箱" class="headerlink" title="沙箱"></a>沙箱</h3><p>在使用支付宝支付的时候，我们就要使用到沙箱功能。<br>支付宝沙箱网址：<a href="https://openhome.alipay.com/platform/appDaily.htm?tab=info" target="_blank" rel="noopener">https://openhome.alipay.com/platform/appDaily.htm?tab=info</a></p><p>在沙箱应用中，我们需要记住自己的APPID,设置RSA2(SHA256)密钥<br>设置密钥官方文档：<a href="https://opendocs.alipay.com/open/291/105971#LDsXr" target="_blank" rel="noopener">https://opendocs.alipay.com/open/291/105971#LDsXr</a></p><p>根据文档生成自己的应用公钥和密钥。</p><h3 id="实现支付宝接口接入"><a href="#实现支付宝接口接入" class="headerlink" title="实现支付宝接口接入"></a>实现支付宝接口接入</h3><p>创建一个keys文件夹，存放alipay_public_2048.txt支付宝公钥和app_private_2048.txt应用私钥<br><img src="/img/%E6%94%AF%E4%BB%98/%E6%94%AF%E4%BB%98%E5%AE%9D%E5%85%AC%E9%92%A5%E5%92%8C%E5%BA%94%E7%94%A8%E7%A7%81%E9%92%A5.png" alt="支付宝公钥和应用私钥"></p><p>文档地址：<a href="https://docs.open.alipay.com/api" target="_blank" rel="noopener">https://docs.open.alipay.com/api</a></p><p>根据文档写一个支付基类pay.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Signature <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, parse_qs</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> decodebytes, encodebytes</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliPay</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    支付宝支付接口(PC端支付接口)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, appid, app_notify_url, app_private_key_path,</span></span></span><br><span class="line"><span class="function"><span class="params">                 alipay_public_key_path, return_url, debug=False)</span>:</span></span><br><span class="line">        self.appid = appid</span><br><span class="line">        self.app_notify_url = app_notify_url</span><br><span class="line">        self.app_private_key_path = app_private_key_path</span><br><span class="line">        self.app_private_key = <span class="literal">None</span></span><br><span class="line">        self.return_url = return_url</span><br><span class="line">        <span class="keyword">with</span> open(self.app_private_key_path) <span class="keyword">as</span> fp:</span><br><span class="line">            self.app_private_key = RSA.importKey(fp.read())</span><br><span class="line">        self.alipay_public_key_path = alipay_public_key_path</span><br><span class="line">        <span class="keyword">with</span> open(self.alipay_public_key_path) <span class="keyword">as</span> fp:</span><br><span class="line">            self.alipay_public_key = RSA.importKey(fp.read())</span><br><span class="line">        <span class="comment">#debug=True为测试模式，false是上线模式</span></span><br><span class="line">        <span class="keyword">if</span> debug <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            self.__gateway = <span class="string">"https://openapi.alipaydev.com/gateway.do"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.__gateway = <span class="string">"https://openapi.alipay.com/gateway.do"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">direct_pay</span><span class="params">(self, subject, out_trade_no, total_amount, return_url=None, **kwargs)</span>:</span></span><br><span class="line">        biz_content = &#123;</span><br><span class="line">            <span class="string">"subject"</span>: subject,</span><br><span class="line">            <span class="string">"out_trade_no"</span>: out_trade_no,</span><br><span class="line">            <span class="string">"total_amount"</span>: total_amount,</span><br><span class="line">            <span class="string">"product_code"</span>: <span class="string">"FAST_INSTANT_TRADE_PAY"</span>,</span><br><span class="line">            <span class="comment"># "qr_pay_mode":4</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        biz_content.update(kwargs)</span><br><span class="line">        data = self.build_body(<span class="string">"alipay.trade.page.pay"</span>, biz_content, self.return_url)</span><br><span class="line">        <span class="keyword">return</span> self.sign_data(data)</span><br><span class="line">    <span class="comment">#构造参数体</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_body</span><span class="params">(self, method, biz_content, return_url=None)</span>:</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"app_id"</span>: self.appid,</span><br><span class="line">            <span class="string">"method"</span>: method,</span><br><span class="line">            <span class="string">"charset"</span>: <span class="string">"utf-8"</span>,</span><br><span class="line">            <span class="string">"sign_type"</span>: <span class="string">"RSA2"</span>,</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>),</span><br><span class="line">            <span class="string">"version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">            <span class="string">"biz_content"</span>: biz_content</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> return_url <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            data[<span class="string">"notify_url"</span>] = self.app_notify_url</span><br><span class="line">            data[<span class="string">"return_url"</span>] = self.return_url</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="comment">#签名数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        data.pop(<span class="string">"sign"</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># 排序后的字符串</span></span><br><span class="line">        unsigned_items = self.ordered_data(data)</span><br><span class="line">        unsigned_string = <span class="string">"&amp;"</span>.join(<span class="string">"&#123;0&#125;=&#123;1&#125;"</span>.format(k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> unsigned_items)</span><br><span class="line">        sign = self.sign(unsigned_string.encode(<span class="string">"utf-8"</span>))</span><br><span class="line">        <span class="comment"># ordered_items = self.ordered_data(data)</span></span><br><span class="line">        quoted_string = <span class="string">"&amp;"</span>.join(<span class="string">"&#123;0&#125;=&#123;1&#125;"</span>.format(k, quote_plus(v)) <span class="keyword">for</span> k, v <span class="keyword">in</span> unsigned_items)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获得最终的订单信息字符串</span></span><br><span class="line">        signed_string = quoted_string + <span class="string">"&amp;sign="</span> + quote_plus(sign)</span><br><span class="line">        <span class="keyword">return</span> signed_string</span><br><span class="line">    <span class="comment">#订单数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ordered_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        complex_keys = []</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> data.items():</span><br><span class="line">            <span class="keyword">if</span> isinstance(value, dict):</span><br><span class="line">                complex_keys.append(key)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将字典类型的数据dump出来</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> complex_keys:</span><br><span class="line">            data[key] = json.dumps(data[key], separators=(<span class="string">','</span>, <span class="string">':'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sorted([(k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> data.items()])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(self, unsigned_string)</span>:</span></span><br><span class="line">        <span class="comment"># 开始计算签名</span></span><br><span class="line">        key = self.app_private_key</span><br><span class="line">        signer = PKCS1_v1_5.new(key)</span><br><span class="line">        signature = signer.sign(SHA256.new(unsigned_string))</span><br><span class="line">        <span class="comment"># base64 编码，转换为unicode表示并移除回车</span></span><br><span class="line">        sign = encodebytes(signature).decode(<span class="string">"utf8"</span>).replace(<span class="string">"\n"</span>, <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">return</span> sign</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_verify</span><span class="params">(self, raw_content, signature)</span>:</span></span><br><span class="line">        <span class="comment"># 开始计算签名</span></span><br><span class="line">        key = self.alipay_public_key</span><br><span class="line">        signer = PKCS1_v1_5.new(key)</span><br><span class="line">        digest = SHA256.new()</span><br><span class="line">        digest.update(raw_content.encode(<span class="string">"utf8"</span>))</span><br><span class="line">        <span class="keyword">if</span> signer.verify(digest, decodebytes(signature.encode(<span class="string">"utf8"</span>))):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">verify</span><span class="params">(self, data, signature)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"sign_type"</span> <span class="keyword">in</span> data:</span><br><span class="line">            sign_type = data.pop(<span class="string">"sign_type"</span>)</span><br><span class="line">        <span class="comment"># 排序后的字符串</span></span><br><span class="line">        unsigned_items = self.ordered_data(data)</span><br><span class="line">        message = <span class="string">"&amp;"</span>.join(<span class="string">u"&#123;&#125;=&#123;&#125;"</span>.format(k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> unsigned_items)</span><br><span class="line">        <span class="keyword">return</span> self._verify(message, signature)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#请求退款接口</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">api_alipay_trade_refund</span><span class="params">(self,refund_amount,out_trade_no=None,trade_no=None,**kwargs)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#构造参数体</span></span><br><span class="line">        biz_content = &#123; <span class="string">"refund_amount"</span>:refund_amount&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#传递可选参数</span></span><br><span class="line">        biz_content.update(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#判断使用站外订单还是支付宝订单</span></span><br><span class="line">        <span class="keyword">if</span> out_trade_no:</span><br><span class="line">            biz_content[<span class="string">"out_trade_no"</span>] = out_trade_no</span><br><span class="line">        <span class="keyword">if</span> trade_no:</span><br><span class="line">            biz_content[<span class="string">"trade_no"</span>] = trade_no</span><br><span class="line"></span><br><span class="line">        <span class="comment">#构造支付接口地址</span></span><br><span class="line">        data = self.build_body(<span class="string">"alipay.trade.refund"</span>,biz_content)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#构造url</span></span><br><span class="line">        url = self.__gateway+<span class="string">"?"</span> + self.sign_data(data)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#请求接口</span></span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        html = r.content.decode(<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> html</span><br></pre></td></tr></table></figure><p>在视图定义方法使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">配置路由</span><br><span class="line">    path(<span class="string">'pay_url/'</span>,pay_url),<span class="comment">#支付宝跳转视图</span></span><br><span class="line">    path(<span class="string">'testpay/'</span>,back_url),<span class="comment">#会调地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,redirect</span><br><span class="line"><span class="comment">#导入公共目录变量</span></span><br><span class="line"><span class="keyword">from</span> mydjango.settings <span class="keyword">import</span> BASE_DIR</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="comment">#导入支付宝支付接口</span></span><br><span class="line"><span class="keyword">from</span> mydjango.pay <span class="keyword">import</span> AliPay</span><br><span class="line"><span class="comment">#引入支付宝沙箱秘钥</span></span><br><span class="line"><span class="comment">#应用私钥</span></span><br><span class="line">app_private_key_string = os.path.join(BASE_DIR,<span class="string">'keys/app_private_2048.txt'</span>)</span><br><span class="line"><span class="comment">#支付宝公钥</span></span><br><span class="line">alipay_public_key_string = os.path.join(BASE_DIR,<span class="string">'keys/alipay_public_2048.txt'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#建立支付实例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ali_object</span><span class="params">()</span>:</span></span><br><span class="line">    app_id = <span class="string">'你的沙箱应用ID'</span>  <span class="comment">#沙箱应用ID</span></span><br><span class="line">    <span class="comment">#支付完成后跳转的地址</span></span><br><span class="line">    return_url = <span class="string">'http://localhost:8000/testpay/'</span></span><br><span class="line">    alipay = AliPay(</span><br><span class="line">        appid = app_id,</span><br><span class="line">        app_notify_url = return_url,</span><br><span class="line">        return_url = return_url,</span><br><span class="line">        app_private_key_path = app_private_key_string,</span><br><span class="line">        alipay_public_key_path = alipay_public_key_string,</span><br><span class="line">        <span class="comment">#支付宝公钥,验证支付宝回传消息，不是自己公钥</span></span><br><span class="line">        debug=<span class="literal">True</span>,<span class="comment">#默认false</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> alipay</span><br><span class="line"></span><br><span class="line"><span class="comment">#支付跳转视图</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pay_url</span><span class="params">(request)</span>:</span></span><br><span class="line">    alipay = get_ali_object()</span><br><span class="line">    <span class="comment">#生成支付的url</span></span><br><span class="line">    query_params = alipay.direct_pay(</span><br><span class="line">        subject=<span class="string">'test'</span>,<span class="comment">#商品简单描述</span></span><br><span class="line">        out_trade_no=<span class="string">'myorder'</span>+str(time.time()),<span class="comment">#订单号，这里使用的是时间戳来做</span></span><br><span class="line">        total_amount= <span class="number">100.00</span><span class="comment">#交易金额（单元：元 保留两位小数）</span></span><br><span class="line">    )</span><br><span class="line">    pay_url = <span class="string">'https://openapi.alipaydev.com/gateway.do?'</span> + query_params</span><br><span class="line">    <span class="keyword">return</span> redirect(pay_url)</span><br><span class="line">    <span class="comment"># return HttpResponse('123')</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#回调网址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">back_url</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'回调成功'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#回调url</span></span><br><span class="line"><span class="comment">#http://localhost:8080/myorder?charset=utf-8&amp;out_trade_no=4370479805276098561&amp;method=alipay.trade.page.pay.return&amp;total_amount=200.00&amp;sign=LCsKfD3ybvAlhzj1%2BJszACsy%2FeOL18p0A%2FmBIa68ZH2SUNb6163FWP5ScmyrGliBlmEtRVcVPkGASVLiY5l5ESTvFkx7OX3FO9%2FtqPRopSvhnf6jaaPjJt90YcG69Z9XZaqJHlK7LqCocLRKSXb4zxWDpek8QRrpUmkn9gxJgKr64Z7%2FlcjsZMpr1SxGjEhyMZp%2FbgcZfD8X4%2BiUkZThXB1LkKNhcRG5gHZTfoiEj%2FKxOFyH%2BNs4klXFjDTe5217UVMUAE351qfq0%2F%2FCXcZ3aHW52XobDAs12J6eVVtijUr8v2xD%2Bpp5SlgCBhkXt86euH4iVfLn61%2FCOMU7b3HLJQ%3D%3D&amp;trade_no=2020061622001482770501026654&amp;auth_app_id=2016092600603658&amp;version=1.0&amp;app_id=2016092600603658&amp;sign_type=RSA2&amp;seller_id=2088102177418159&amp;timestamp=2020-06-16%2013%3A27%3A16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#回调网址中的参数</span></span><br><span class="line"><span class="comment"># out_trade_no=4370479805276098561  #订单号</span></span><br><span class="line"><span class="comment"># total_amount=200.00               #订单价格</span></span><br><span class="line"><span class="comment">#sign='LCsKfD3ybvAlhzj1%2BJszACsy%2FeOL18p0A%2FmBIa68ZH2SUNb6163FWP5ScmyrGliBlmEtRVcVPkGASVLiY5l5ESTvFkx7OX3FO9%2FtqPRopSvhnf6jaaPjJt90YcG69Z9XZaqJHlK7LqCocLRKSXb4zxWDpek8QRrpUmkn9gxJgKr64Z7%2FlcjsZMpr1SxGjEhyMZp%2FbgcZfD8X4%2BiUkZThXB1LkKNhcRG5gHZTfoiEj%2FKxOFyH%2BNs4klXFjDTe5217UVMUAE351qfq0%2F%2FCXcZ3aHW52XobDAs12J6eVVtijUr8v2xD%2Bpp5SlgCBhkXt86euH4iVfLn61%2FCOMU7b3HLJQ%3D%3D'#签名</span></span><br><span class="line"><span class="comment"># trade_no=2020061622001482770501026654 #支付宝订单号</span></span><br><span class="line"><span class="comment"># auth_app_id=2016092600603658  #应用ID</span></span><br><span class="line"><span class="comment"># version=1.0                     #版本</span></span><br><span class="line"><span class="comment"># sign_type='RSA2'                  #算法</span></span><br><span class="line"><span class="comment"># seller_id=2088102177418159    #支付者ID</span></span><br><span class="line"><span class="comment"># timestamp='2020-06-16%2013%3A27%3A16'#时间戳</span></span><br></pre></td></tr></table></figure><p>在沙箱账号中，有个买家和卖家账号，在使用沙箱做测试支付的时候，使用的是买家账号，账号密码还有登陆密码都有说明，还需要充值买家账号余额，这里的金钱都是虚拟的。这样就可以完成测试支付宝付款了。快去测试一波吧！！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;现在所有的门户网站还是一下应用，都离不开第三方支付，我们今天讲一下第三方的支付接口也就是支付宝接口付款。&lt;br&gt;支付宝支付采用了RSA加密签名的安全通信机制，开发者可以通过支付宝的公钥验证消息的来源，同时使用自己的私钥进行信息加密。RSA算法及数字签名机制是服务窗平台与开发者网关安全通信的基础。&lt;/p&gt;
    
    </summary>
    
    
      <category term="支付" scheme="https://wzh3683.github.io/hexo_blog/categories/%E6%94%AF%E4%BB%98/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
      <category term="支付" scheme="https://wzh3683.github.io/hexo_blog/tags/%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>&#39;分布式ID雪花算法(snowflake)&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/14/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95-snowflake/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/14/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95-snowflake/</id>
    <published>2020-06-14T09:43:19.000Z</published>
    <updated>2020-06-20T10:26:13.950Z</updated>
    
    <content type="html"><![CDATA[<p>唯一ID可以标识数据的唯一性，在分布式系统中生成唯一ID的方案有很多，常见的方式大概有以下三种：</p><p>依赖数据库，使用如MySQL自增列或Oracle序列等。<br><a href="https://okwzh.cn/2020/06/14/uuid%E7%94%9F%E6%88%90%E5%94%AF%E4%B8%80id/" target="_blank" rel="noopener">根据UUID生成</a><br>snowflake雪花算法</p><a id="more"></a><h3 id="为什么使用snowflake生成ID"><a href="#为什么使用snowflake生成ID" class="headerlink" title="为什么使用snowflake生成ID"></a>为什么使用snowflake生成ID</h3><p>使用uuid生成订单号这类东西也能凑合用，但是它有着罄竹难书的“罪行”：肉眼可见，它是无序的；长度是64位数字字母随机组合的字符串，占用空间巨大；完全不具备业务属性，也就是说使用uuid你完全无法推算出它到底是干嘛的；因为无序，所以趋势递增就更不用指望了；所以用uuid生成订单号就是自杀行为，适合它的是类似生成token令牌的场景。</p><p>雪花算法(snowflake)是Twitter开源的分布式ID生成算法，结果是一个long型的ID。为了满足Twitter每秒上万条消息的请求，每条消息都必须分配一条唯一的id，这些id还需要一些大致的顺序，让twitter可以通过一定的索引来进行检索，而在Twitter庞大的分布式系统中不同机器产生的id必须又必须不同。它的好处显而易见，不仅全局唯一，并且有序按时间递增，同时占用空间少，生成的id仅仅是19位的整形数字，正好契合mysql的bigint数据类型，简直完美。</p><h3 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h3><p>其核心思想是：使用41bit作为毫秒数，10bit作为机器的ID（5个bit是数据中心，5个bit的机器ID），12bit作为毫秒内的流水号，最后还有一个符号位，永远是0。<br>组成：<br><img src="/img/%E7%AE%97%E6%B3%95/snowflake%E7%BB%84%E6%88%90.png" alt="snowflake组成"></p><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><p>整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右。 毫秒数在高位，自增序列在低位，整个ID都是趋势递增的。 不依赖数据库等第三方系统，以服务的方式部署，稳定性更高，生成ID的性能也是非常高的。 可以根据自身业务特性分配bit位，非常灵活。</p><h3 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h3><p>强依赖机器时钟，如果机器上时钟回拨，会导致发号重复或者服务会处于不可用状态。</p><h3 id="安装库"><a href="#安装库" class="headerlink" title="安装库"></a>安装库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pysnowflake</span><br></pre></td></tr></table></figure><h3 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snowflake_start_server --work&#x3D;1</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%AE%97%E6%B3%95/%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1.png" alt="下载和启动服务"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">指定端口开启服务</span><br><span class="line">snowflake_start_server --work=<span class="number">1</span> --port=端口号</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%AE%97%E6%B3%95/%E6%8C%87%E5%AE%9A%E7%AB%AF%E5%8F%A3.png" alt="指定端口"></p><h3 id="服务信息"><a href="#服务信息" class="headerlink" title="服务信息"></a>服务信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> snowflake.client</span><br><span class="line"></span><br><span class="line">print(snowflake.client.get_stats())</span><br><span class="line"></span><br><span class="line"><span class="comment">#worker是服务信息,time是时间戳</span></span><br><span class="line"><span class="comment">#&#123;'dc': 0, 'worker': 1, 'timestamp': 1592131606294, 'last_timestamp': 550281600000, 'sequence': 0, 'sequence_overload': 0, 'errors': 0&#125;</span></span><br></pre></td></tr></table></figure><h3 id="获取ID"><a href="#获取ID" class="headerlink" title="获取ID"></a>获取ID</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> snowflake.client</span><br><span class="line"></span><br><span class="line">print(snowflake.client.get_guid())</span><br><span class="line"></span><br><span class="line"><span class="comment">#4369836784469676033</span></span><br></pre></td></tr></table></figure><h3 id="根据ID反解析服务"><a href="#根据ID反解析服务" class="headerlink" title="根据ID反解析服务"></a>根据ID反解析服务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> snowflake.client</span><br><span class="line"></span><br><span class="line">sid = snowflake.client.get_guid()</span><br><span class="line">print(sid)</span><br><span class="line"><span class="comment">#ID：4369838396760133633</span></span><br><span class="line">bid = bin(sid)</span><br><span class="line">print(bid)</span><br><span class="line"><span class="comment">#第一位是标识符，此后是41位的时间戳，紧接着10位的节点标识码，最后12位的递增序列，</span></span><br><span class="line"><span class="comment"># 从后面数12位是：000000000001，再数5位是：00001 这5位就是某个节点的存储标识，我们就二进制的00001转换为十进制</span></span><br><span class="line"><span class="comment">#0b11110010100100110010001101111010010100110000000001000000000001</span></span><br><span class="line">cid = bin(sid)[<span class="number">47</span>:<span class="number">52</span>]</span><br><span class="line">print(<span class="string">'存储节点'</span>,cid)</span><br><span class="line"><span class="comment">#存储节点 00001</span></span><br><span class="line">print(<span class="string">'反解析服务'</span>,int(cid,<span class="number">2</span>))</span><br><span class="line"><span class="comment">#反解析服务 1</span></span><br></pre></td></tr></table></figure><h3 id="使用bigint存储"><a href="#使用bigint存储" class="headerlink" title="使用bigint存储"></a>使用bigint存储</h3><p>在使用好处显而易见，不仅全局唯一，并且有序按时间递增，同时占用空间少，生成的id仅仅是19位的整形数字，正好契合mysql的bigint数据类型，简直完美。<br>但是使用bigint有个bug，就是19位数字传到前端会发生关于js数字精度丢失问题。<br><a href="https://okwzh.cn/2020/06/14/%E5%85%B3%E4%BA%8Ejs%E6%95%B0%E5%AD%97%E8%BF%87%E9%95%BF%E5%87%BA%E7%8E%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">关于精度丢失问题</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;唯一ID可以标识数据的唯一性，在分布式系统中生成唯一ID的方案有很多，常见的方式大概有以下三种：&lt;/p&gt;
&lt;p&gt;依赖数据库，使用如MySQL自增列或Oracle序列等。&lt;br&gt;&lt;a href=&quot;https://okwzh.cn/2020/06/14/uuid%E7%94%9F%E6%88%90%E5%94%AF%E4%B8%80id/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;根据UUID生成&lt;/a&gt;&lt;br&gt;snowflake雪花算法&lt;/p&gt;
    
    </summary>
    
    
      <category term="算法" scheme="https://wzh3683.github.io/hexo_blog/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
      <category term="算法" scheme="https://wzh3683.github.io/hexo_blog/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>&#39;关于js数字过长出现的精度丢失问题&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/14/%E5%85%B3%E4%BA%8Ejs%E6%95%B0%E5%AD%97%E8%BF%87%E9%95%BF%E5%87%BA%E7%8E%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/14/%E5%85%B3%E4%BA%8Ejs%E6%95%B0%E5%AD%97%E8%BF%87%E9%95%BF%E5%87%BA%E7%8E%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98/</id>
    <published>2020-06-14T07:37:27.000Z</published>
    <updated>2020-06-20T10:27:58.249Z</updated>
    
    <content type="html"><![CDATA[<p>在JavaScript中，由于计算机的二进制实现和位数限制有些数无法有限表示。就像一些无理数不能有限表示。<br>js的整数和浮点数都属于Number类型的，所有数字都是以64位浮点数形式存储。所以我们在前端打印的时候，<br>发现一个很奇怪的问题，就是当console.log(1.00)时，我们发现打印结果是1,后边的.00都被舍去。虽然数值是正确的，<br>但是和理想结果有些偏差。</p><a id="more"></a><h3 id="针对雪花算法出现的问题"><a href="#针对雪花算法出现的问题" class="headerlink" title="针对雪花算法出现的问题"></a>针对雪花算法出现的问题</h3><p>在做<a href="">雪花算法</a>的时候，说过使用model中的bigint是最好的存储方式，但是在做的时候发现一个问题，就是在前端展示出现展示效果问题，话不多说，上代码</p><span class='p red'>这是我保存数据库的结果</span><p><img src="/img/Js%E6%95%B0%E5%AD%97%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B1%95%E7%A4%BA%E7%BB%93%E6%9E%9C.png" alt="数据库展示结果"></p><span class='p red'>这是我后端获取数据</span><p><img src="/img/Js%E6%95%B0%E5%AD%97%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/%E5%90%8E%E7%AB%AF%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE.png" alt="后端展示数据"></p><span class='p red'>这是我前端获取数据的结果</span><p><img src="/img/Js%E6%95%B0%E5%AD%97%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/%E5%89%8D%E7%AB%AF%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.png" alt="前端获取数据"><br>但是在我前端获取数据结果的时候，发现了一件很怪异的事情，就是js自动将我的数据给修改了，也就是前16位都是对着的。经过测试<br>发现，我的后端数据没有问题，在传递给前端的时候出现了差错，经过咨询和百度，发现了是js精度丢失的问题。<br>最常用的解决办法就是使用字符串类型。于是我把数据库的bitint类型给改成了varchar。完美解决。</p><h3 id="JavaScript的16位长度数字不变，超过就发生精度丢失问题。"><a href="#JavaScript的16位长度数字不变，超过就发生精度丢失问题。" class="headerlink" title="JavaScript的16位长度数字不变，超过就发生精度丢失问题。"></a>JavaScript的16位长度数字不变，超过就发生精度丢失问题。</h3><p>针对数字丢失问题，我做了实验。</p><figure class="highlight js"><figcaption><span>16位数字没变</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mounted()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'最大安全数'</span>,<span class="number">1111111111111111</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最大安全数 1111111111111111</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>17位发生变化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mounted()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'最大安全数'</span>,<span class="number">11111111111111111</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最大安全数 11111111111111112</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>20位发生变化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mounted()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'最大安全数'</span>,<span class="number">11111111111111111111</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 最大安全数 11111111111111110000</span></span><br></pre></td></tr></table></figure><p>根据以上代码，我们可以清晰看到在16位整数可以发现数字没有变化，但是在第17位的时候就发生了变化，长度越长后边都以0显示。<br><br>    </p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法:"></a>解决办法:</h3><pre><code>对于整数，前端出现问题的几率可能比较低，毕竟很少有业务需要需要用到超大整数，只要运算结果不超过 Math.pow(2, 53) 就不会丢失精度。对于小数，前端出现问题的几率还是很多的，尤其在一些电商网站涉及到金额等数据。解决方式：把小数放到位整数（乘倍数），再缩小回原来倍数（除倍数）</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在JavaScript中，由于计算机的二进制实现和位数限制有些数无法有限表示。就像一些无理数不能有限表示。&lt;br&gt;js的整数和浮点数都属于Number类型的，所有数字都是以64位浮点数形式存储。所以我们在前端打印的时候，&lt;br&gt;发现一个很奇怪的问题，就是当console.log(1.00)时，我们发现打印结果是1,后边的.00都被舍去。虽然数值是正确的，&lt;br&gt;但是和理想结果有些偏差。&lt;/p&gt;
    
    </summary>
    
    
      <category term="vue" scheme="https://wzh3683.github.io/hexo_blog/categories/vue/"/>
    
    
      <category term="vue" scheme="https://wzh3683.github.io/hexo_blog/tags/vue/"/>
    
      <category term="js" scheme="https://wzh3683.github.io/hexo_blog/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>&#39;uuid生成唯一id&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/14/uuid%E7%94%9F%E6%88%90%E5%94%AF%E4%B8%80id/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/14/uuid%E7%94%9F%E6%88%90%E5%94%AF%E4%B8%80id/</id>
    <published>2020-06-14T07:36:27.000Z</published>
    <updated>2020-06-20T10:14:23.247Z</updated>
    
    <content type="html"><![CDATA[<p>当我们在做订单号的时候，可以发现我们使用订单号有个硬性条件，就是它最好的唯一性的,且最好是自增长。<br>在我们python中，系统自带了一个唯一的模块，就是uuid。但是我们使用uuid来生成订单号虽然也能使用，但是却有一个致命的缺点，就是无序。</p><a id="more"></a><h3 id="关于UUID-univeral-unique-identifier"><a href="#关于UUID-univeral-unique-identifier" class="headerlink" title="关于UUID(univeral unique identifier)"></a>关于UUID(univeral unique identifier)</h3><p>uuid是128位的全局唯一标识符（univeral unique identifier），通常用32位的一个字符串的形式来表现。python中自带了uuid模块来进行uuid的生成和管理工作。在python中的uuid模块是基于MAC地址、时间戳、命名空间、随机数、伪随机数来生成的。</p><span class='p red'>uuid.uuid1()</span><p>基于MAC地址，时间戳，随机数来生成唯一的uuid，可以保证全球范围内的唯一性。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line">print(uuid.uuid1())</span><br><span class="line"></span><br><span class="line"><span class="comment">#b8200238-ae14-11ea-859b-68ecc5357e24</span></span><br></pre></td></tr></table></figure><span class='p red'>uuid.uuid2()</span><p>uuid.uuid2()算法与uuid1相同，不同的是把时间戳的前4位置换为POSIX的UID。不过需要注意的是python中没有基于DCE的算法，所以python的uuid模块中没有uuid2这个方法。</p><span class='p red'>uuid.uuid3()</span><p>通过计算一个命名空间和名字的md5散列值来给出一个uuid，所以可以保证命名空间中的不同名字具有不同的uuid，但是相同的名字就是相同的uuid了。<br>namespace并不是一个自己手动指定的字符串或其他量，而是在uuid模块中本身给出的一些值。比如uuid.NAMESPACE_DNS，uuid.NAMESPACE_OID，uuid.NAMESPACE_OID这些值。这些值本身也是UUID对象，根据一定的规则计算得出。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">name = <span class="string">'uuid_name'</span></span><br><span class="line">namespace = uuid.NAMESPACE_URL</span><br><span class="line">print(uuid.uuid3(namespace,name))</span><br><span class="line"></span><br><span class="line"><span class="comment">#5b4c833b-b8f0-36de-84d3-5ab20550d1c6</span></span><br></pre></td></tr></table></figure><span class='p red'>uuid.uuid4()</span><p>通过伪随机数得到uuid，是有一定概率重复的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">print(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="comment">#1c0f445e-a357-4568-a9bc-25e0b4c07330</span></span><br></pre></td></tr></table></figure><span class='p red'>uuid.uuid5()</span><p>和uuid3基本相同，只不过采用的散列算法是sha1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">name = <span class="string">'uuid_name'</span></span><br><span class="line">namespace = uuid.NAMESPACE_URL</span><br><span class="line">print(uuid.uuid5(namespace,name))</span><br><span class="line"></span><br><span class="line"><span class="comment">#87fec518-b116-571f-87e3-e40ab834ff45</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当我们在做订单号的时候，可以发现我们使用订单号有个硬性条件，就是它最好的唯一性的,且最好是自增长。&lt;br&gt;在我们python中，系统自带了一个唯一的模块，就是uuid。但是我们使用uuid来生成订单号虽然也能使用，但是却有一个致命的缺点，就是无序。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>&#39;使用又拍云及拖拽上传&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/09/day10-vue+django+python%E5%AE%8C%E6%88%90%E5%8F%88%E6%8B%8D%E4%BA%91%E5%AE%9E%E7%8E%B0%E6%8B%96%E6%8B%BD%E5%AD%98%E5%82%A8/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/09/day10-vue+django+python%E5%AE%8C%E6%88%90%E5%8F%88%E6%8B%8D%E4%BA%91%E5%AE%9E%E7%8E%B0%E6%8B%96%E6%8B%BD%E5%AD%98%E5%82%A8/</id>
    <published>2020-06-09T02:28:35.000Z</published>
    <updated>2020-06-20T10:26:53.774Z</updated>
    
    <content type="html"><![CDATA[<p>官方网址：<a href="https://www.upyun.com/" target="_blank" rel="noopener">又拍云官网</a></p><p>1.<span class='p red'>点击注册或登录</span></p><a id="more"></a><p>2.<span class='p red'>点击云存储</span><br><img src="/img/%E5%8F%88%E6%8B%8D%E4%BA%91/%E5%8F%88%E6%8B%8D%E4%BA%911.png" alt="又拍云1"></p><p>3.<span class='p red'>创建服务</span><br><img src="/img//%E5%8F%88%E6%8B%8D%E4%BA%91/%E5%8F%88%E6%8B%8D%E4%BA%912.png" alt="又拍云2"></p><p>4.<span class='p red'>查看又拍云图片</span><br><img src="/img//%E5%8F%88%E6%8B%8D%E4%BA%91/%E5%8F%88%E6%8B%8D%E4%BA%913.png" alt="又拍云3"><br>  4.1<span class='p red'>分配的网址/图片名</span><br>    <a href="http://md-upyun.test.upcdn.net/图片名" target="_blank" rel="noopener">http://md-upyun.test.upcdn.net/图片名</a></p><p>  4.2<span class='p red'>进入文件管理查看</span></p><p>5.<span class='p red'>添加操作员</span><br><img src="/img//%E5%8F%88%E6%8B%8D%E4%BA%91/%E5%8F%88%E6%8B%8D%E4%BA%914.jpg" alt="添加操作员"></p><p>6.<span class='p red'>添加操作员</span><br><img src="/img//%E5%8F%88%E6%8B%8D%E4%BA%91/%E5%8F%88%E6%8B%8D%E4%BA%915.jpg" alt="创建操作员"></p><span class='p red'>下载依赖</span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install upyun</span><br></pre></td></tr></table></figure><h3 id="使用又拍云下载大文件"><a href="#使用又拍云下载大文件" class="headerlink" title="使用又拍云下载大文件"></a>使用又拍云下载大文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#文件流操作(节省内存)</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./bg.png'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment">#上传文件</span></span><br><span class="line">    res = up.put(<span class="string">'/bg.png'</span>,f,checksum=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云进行写入文件"><a href="#使用又拍云进行写入文件" class="headerlink" title="使用又拍云进行写入文件"></a>使用又拍云进行写入文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line">value = <span class="string">'hello python,恩呢恩'</span></span><br><span class="line">up.put(<span class="string">'/yun.txt'</span>,value)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云进行目录操作，创建文件夹"><a href="#使用又拍云进行目录操作，创建文件夹" class="headerlink" title="使用又拍云进行目录操作，创建文件夹"></a>使用又拍云进行目录操作，创建文件夹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#目录操作,创建文件夹</span></span><br><span class="line">up.mkdir(<span class="string">'/ypyun_test/'</span>)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云移动文件"><a href="#使用又拍云移动文件" class="headerlink" title="使用又拍云移动文件"></a>使用又拍云移动文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#移动文件</span></span><br><span class="line"><span class="comment">#src移动谁，dest移动到哪</span></span><br><span class="line">up.move(<span class="string">'bg.png'</span>,<span class="string">'/ypyun_test/bg.png'</span>)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云复制文件"><a href="#使用又拍云复制文件" class="headerlink" title="使用又拍云复制文件"></a>使用又拍云复制文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#复制文件</span></span><br><span class="line">up.copy(<span class="string">'9c1d0bd8-8f51-11ea-a567-005056c00008.jpg'</span>,<span class="string">'/ypyun_test/9c1d0bd8-8f51-11ea-a567-005056c00008.jpg'</span>)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云断点续传"><a href="#使用又拍云断点续传" class="headerlink" title="使用又拍云断点续传"></a>使用又拍云断点续传</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#断点续传(第二次传的时候是从第一次剩下的开始继续上传)</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'D:\学习资料\视频\猫和老鼠.mp4'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="comment"># need_resume=True断点续传</span></span><br><span class="line">    res = up.put(<span class="string">'/ypyun_test/猫和老鼠.mp4'</span>,f,checksum=<span class="literal">True</span>,need_resume=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云进行下载"><a href="#使用又拍云进行下载" class="headerlink" title="使用又拍云进行下载"></a>使用又拍云进行下载</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#下载图片</span></span><br><span class="line">res = up.get(<span class="string">'/ypyun_test/9c1d0bd8-8f51-11ea-a567-005056c00008.jpg'</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><h3 id="使用又拍云进行删除"><a href="#使用又拍云进行删除" class="headerlink" title="使用又拍云进行删除"></a>使用又拍云进行删除</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"><span class="comment">#新建又拍云实例</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line"><span class="comment">#删除</span></span><br><span class="line">up.delete(<span class="string">'/ypyun_test/9c1d0bd8-8f51-11ea-a567-005056c00008.jpg'</span>)</span><br></pre></td></tr></table></figure><h3 id="拖拽上传代码示例"><a href="#拖拽上传代码示例" class="headerlink" title="拖拽上传代码示例"></a>拖拽上传代码示例</h3><p>vue代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> @<span class="attr">change</span>=<span class="string">"upload_upyun"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"upload"</span>&gt;</span></span><br><span class="line">                    拖拽上传</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line">    data()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted () &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">'.upload'</span>);</span></span><br><span class="line"><span class="actionscript">        upload.addEventListener(<span class="string">'dragenter'</span>, <span class="keyword">this</span>.onDrag, <span class="literal">false</span>);</span></span><br><span class="line"><span class="actionscript">        upload.addEventListener(<span class="string">'dragover'</span>, <span class="keyword">this</span>.onDrag, <span class="literal">false</span>);</span></span><br><span class="line"><span class="actionscript">        upload.addEventListener(<span class="string">'drop'</span>, <span class="keyword">this</span>.onDrop, <span class="literal">false</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    <span class="comment">//自定义方法</span></span></span><br><span class="line">    methods:&#123;</span><br><span class="line">        onDrag (e) &#123;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">            e.preventDefault();</span><br><span class="line">        &#125;,</span><br><span class="line">        onDrop (e) &#123;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">            e.preventDefault();</span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.upload_upyun(e.dataTransfer.files);</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="actionscript">        <span class="comment">//上传又拍云</span></span></span><br><span class="line"><span class="actionscript">        upload_upyun:<span class="function"><span class="keyword">function</span><span class="params">(files)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">//获取文件对象</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// let file = e.target.files[0];</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> file = files[<span class="number">0</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="comment">//声明参数</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> param = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="actionscript">            param.append(<span class="string">'file'</span>,file);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> config = &#123;</span></span><br><span class="line"><span class="actionscript">                headers: &#123; <span class="string">'Content-Type'</span>: <span class="string">'multipart/form-data'</span> &#125;</span></span><br><span class="line">            &#125;  </span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.axios(&#123;</span></span><br><span class="line"><span class="actionscript">                url:<span class="string">'http://localhost:8000/ypy/'</span>,</span></span><br><span class="line"><span class="actionscript">                method:<span class="string">'POST'</span>,</span></span><br><span class="line">                data:param,</span><br><span class="line">                config:config</span><br><span class="line"><span class="javascript">            &#125;).then(<span class="function"><span class="params">resp</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(resp)</span></span><br><span class="line">            &#125;)             </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.upload</span> &#123;</span></span><br><span class="line">    margin: 100px auto;</span><br><span class="line">    width: 300px;</span><br><span class="line">    height: 150px;</span><br><span class="line"><span class="css">    <span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#f00</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>django代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">urls：    path(<span class="string">'ypy/'</span>,UpyunLoad.as_view()),</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> upyun</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义文件上传类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpyunLoad</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment">#前端获取文件</span></span><br><span class="line">        img = request.FILES.get(<span class="string">'file'</span>)</span><br><span class="line">        <span class="comment">#创建文件名</span></span><br><span class="line">        file_name = str(uuid.uuid1())+<span class="string">'.jpg'</span></span><br><span class="line">        print(file_name)</span><br><span class="line">        up = upyun.UpYun(<span class="string">'你的空间服务名称'</span>, username=<span class="string">'操作员'</span>, password=<span class="string">'生成密码'</span>)</span><br><span class="line">        <span class="comment">#x-gmkerl-rotate旋转角度，目前只允许设置：auto，90，180，270</span></span><br><span class="line">        headers = &#123;<span class="string">'x-gmkerl-rotate'</span>: <span class="string">'auto'</span>&#125;</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> img.chunks():</span><br><span class="line">            res = up.put(<span class="string">'/%s'</span>%file_name, chunk, checksum=<span class="literal">True</span>, headers=headers)</span><br><span class="line">        <span class="comment"># 返回结果</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'filename'</span>: file_name&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;官方网址：&lt;a href=&quot;https://www.upyun.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;又拍云官网&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;1.&lt;span class=&#39;p red&#39;&gt;点击注册或登录&lt;/span&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="vue" scheme="https://wzh3683.github.io/hexo_blog/tags/vue/"/>
    
      <category term="又拍云" scheme="https://wzh3683.github.io/hexo_blog/tags/%E5%8F%88%E6%8B%8D%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>&#39;结合又拍云实现多线程异步分块上传&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/09/%E7%BB%93%E5%90%88%E5%8F%88%E6%8B%8D%E4%BA%91%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%82%E6%AD%A5%E5%88%86%E5%9D%97%E4%B8%8A%E4%BC%A0/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/09/%E7%BB%93%E5%90%88%E5%8F%88%E6%8B%8D%E4%BA%91%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%82%E6%AD%A5%E5%88%86%E5%9D%97%E4%B8%8A%E4%BC%A0/</id>
    <published>2020-06-09T02:28:35.000Z</published>
    <updated>2020-06-20T10:29:22.625Z</updated>
    
    <content type="html"><![CDATA[<p>上一篇我们已经说过又拍云的<a href="https://okwzh.cn/2020/06/09/day10-vue+django+python%E5%AE%8C%E6%88%90%E5%8F%88%E6%8B%8D%E4%BA%91%E5%AE%9E%E7%8E%B0%E6%8B%96%E6%8B%BD%E5%AD%98%E5%82%A8/" target="_blank" rel="noopener">常用操作</a>,今天我们讲一下结合多线程实现异步上传</p><span class='p red'>当我们使用第三方依赖，要注意模块是不是最新依赖，进行更新</span><p>UPYUN Python SDK文档：<a href="https://github.com/upyun/python-sdk#upyun-python-sdk" target="_blank" rel="noopener">点击跳转</a><br>查看最新python SDK：<a href="ontawesome.com.cn/faicons/">点击跳转</a></p><a id="more"></a><h3 id="多线程异步实现又拍云上传"><a href="#多线程异步实现又拍云上传" class="headerlink" title="多线程异步实现又拍云上传"></a>多线程异步实现又拍云上传</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> upyun  <span class="comment"># 又拍云</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># 文件模块</span></span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># 多线程模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建又拍云实例</span></span><br><span class="line"><span class="comment"># 三个参数,又拍云服务名称，操作员名称，操作员密码</span></span><br><span class="line">up = upyun.UpYun(<span class="string">'服务名称'</span>, <span class="string">'操作员名称'</span>, <span class="string">'操作员密码'</span>)</span><br><span class="line"><span class="comment"># 分块上传</span></span><br><span class="line">uploader = up.init_multi_uploader(<span class="string">'/upyun_python/upyun_sanguo.mp4'</span>)</span><br><span class="line"><span class="comment">#同步上传</span></span><br><span class="line"><span class="comment"># uploader.upload(0,os.urandom(1024*1024))</span></span><br><span class="line"><span class="comment"># uploader.upload(1,os.urandom(1024*1024))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#采用多线程调用上传</span></span><br><span class="line"><span class="comment">#创建线程池</span></span><br><span class="line">threads = []</span><br><span class="line"><span class="comment">#uploader.upload不加括号，这里是声明，不是调用，调用的话还是同步</span></span><br><span class="line"><span class="comment">#参数写在args里,(0声明异步上传序号)</span></span><br><span class="line">t1 = threading.Thread(target=uploader.upload,args=(<span class="number">0</span>,os.urandom(<span class="number">1024</span>*<span class="number">1024</span>)))</span><br><span class="line"><span class="comment"># #添加到线程池</span></span><br><span class="line">threads.append(t1)</span><br><span class="line">t2 = threading.Thread(target=uploader.upload,args=(<span class="number">1</span>,os.urandom(<span class="number">1024</span>*<span class="number">1024</span>)))</span><br><span class="line">threads.append(t2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动多线程</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.start()</span><br><span class="line"><span class="comment">#     #阻塞主线程</span></span><br><span class="line">    t.join()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # #声明调用结束</span></span><br><span class="line">res = uploader.complete()</span><br></pre></td></tr></table></figure><h3 id="多线程异步对文件进行分块上传"><a href="#多线程异步对文件进行分块上传" class="headerlink" title="多线程异步对文件进行分块上传"></a>多线程异步对文件进行分块上传</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#上传又拍云文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upyun_Post</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="comment"># 获取视频文件</span></span><br><span class="line">        file = request.FILES.get(<span class="string">'file'</span>)</span><br><span class="line">        print(file)</span><br><span class="line">        up = upyun.UpYun(<span class="string">'服务名称'</span>, <span class="string">'操作员名称'</span>, <span class="string">'操作员密码'</span>)</span><br><span class="line">        uploader = up.init_multi_uploader(<span class="string">"/upyun-python-sdk/%s"</span> % file, part_size=(<span class="number">1024</span> * <span class="number">2048</span>))</span><br><span class="line">        threads = []</span><br><span class="line">        <span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(file.chunks(chunk_size=(<span class="number">1024</span> * <span class="number">2048</span>))):</span><br><span class="line">            t = threading.Thread(target=uploader.upload, args=(index, value))</span><br><span class="line">            threads.append(t)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> threads:</span><br><span class="line">            i.start()</span><br><span class="line">            i.join()</span><br><span class="line">        res = uploader.complete()</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'code'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'上传成功'</span>&#125;)</span><br><span class="line">        <span class="comment"># return HttpResponse(json.dumps(&#123;'filename': file&#125;), content_type='application/json')</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上一篇我们已经说过又拍云的&lt;a href=&quot;https://okwzh.cn/2020/06/09/day10-vue+django+python%E5%AE%8C%E6%88%90%E5%8F%88%E6%8B%8D%E4%BA%91%E5%AE%9E%E7%8E%B0%E6%8B%96%E6%8B%BD%E5%AD%98%E5%82%A8/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;常用操作&lt;/a&gt;,今天我们讲一下结合多线程实现异步上传&lt;/p&gt;
&lt;span class=&#39;p red&#39;&gt;当我们使用第三方依赖，要注意模块是不是最新依赖，进行更新&lt;/span&gt;

&lt;p&gt;UPYUN Python SDK文档：&lt;a href=&quot;https://github.com/upyun/python-sdk#upyun-python-sdk&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;点击跳转&lt;/a&gt;&lt;br&gt;查看最新python SDK：&lt;a href=&quot;ontawesome.com.cn/faicons/&quot;&gt;点击跳转&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="又拍云" scheme="https://wzh3683.github.io/hexo_blog/tags/%E5%8F%88%E6%8B%8D%E4%BA%91/"/>
    
      <category term="多线程" scheme="https://wzh3683.github.io/hexo_blog/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
      <category term="异步" scheme="https://wzh3683.github.io/hexo_blog/tags/%E5%BC%82%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>&#39;响应状态码和请求方法&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/08/%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/08/%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81/</id>
    <published>2020-06-08T10:28:33.000Z</published>
    <updated>2020-06-20T10:20:19.999Z</updated>
    
    <content type="html"><![CDATA[<h3 id="状态码分类-HTTP-Status-Code"><a href="#状态码分类-HTTP-Status-Code" class="headerlink" title="状态码分类(HTTP Status Code)"></a>状态码分类(HTTP Status Code)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1XX- 信息型，服务器收到请求，需要请求者继续操作。</span><br><span class="line">2XX- 成功型，请求成功收到，理解并处理。</span><br><span class="line">3XX - 重定向，需要进一步的操作以完成请求。</span><br><span class="line">4XX - 客户端错误，请求包含语法错误或无法完成请求。</span><br><span class="line">5XX - 服务器错误，服务器在处理请求的过程中发生了错误。</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="常用状态码"><a href="#常用状态码" class="headerlink" title="常用状态码"></a>常用状态码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">100系列：</span><br><span class="line">    100   继续   客户端应当继续发送请求</span><br><span class="line"></span><br><span class="line">200系列：</span><br><span class="line">200   成功   服务器成功处理了请求</span><br><span class="line">300系列：</span><br><span class="line">301   永久移动   请求的网页已永久移动到新位置，永久重定向</span><br><span class="line">302   临时移动   请求的网页暂时跳转到其他页面，临时重定向</span><br><span class="line">400系列：</span><br><span class="line">400   错误请求   服务器无法解析该请求</span><br><span class="line">401   未授权     请求没有进行身份验证或验证未通过</span><br><span class="line">403   禁止访问   服务器拒绝此请求</span><br><span class="line">404   未找到     服务器找不到请求的网页</span><br><span class="line">500系列：</span><br><span class="line">500  服务器内部错误   服务器遇到错误，无法完成请求</span><br><span class="line">501   未实现          服务器不具备完成请求的功能</span><br><span class="line">502   错误网关        服务器做为网关或代理，从上游服务器收到无效响应</span><br><span class="line">504   网关超时        服务器做为网关或代理，但是没有及时从上游服务器收到请求</span><br><span class="line"> 505   HTTP版本不支持  服务器不支持请求中所用的HTTP协议版本</span><br></pre></td></tr></table></figure><h3 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1).GET：请求页面，并返回页面内容  </span><br><span class="line">2).POST：用于提交表单数据或上传文件，数据包含在请求体中</span><br><span class="line">3).PUT：从客户端向服务器传送的数据取代指定文档中的内容</span><br><span class="line">4).DELETE：请求服务器删除指定的页面</span><br><span class="line">5).CONNECT：把服务器当做跳板，让服务器代替客户端访问其他网页</span><br><span class="line">6).HEAD：类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头</span><br><span class="line">7).OPTIONS：允许客户端查看服务器的性能</span><br><span class="line">8).TRACE：回显服务器收到的请求，主要用于测试或诊断</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重点掌握GET&amp;POST区别：</span><br><span class="line">1.GET请求中的参数包含在URL里面，数据可以在URL中看到。</span><br><span class="line">而POST请求的URL不会包含这些数据，POST的数据都是通过表单形式传输的，会包含在请求体中。</span><br><span class="line">    2.GET请求提交的数据最多之后1024字节，而POST方式没有限制</span><br><span class="line">    3.POST请求比GET请求相对安全。</span><br></pre></td></tr></table></figure><h3 id="请求响应步骤"><a href="#请求响应步骤" class="headerlink" title="请求响应步骤"></a>请求响应步骤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端连接到Web服务器-&gt;发送Http请求-&gt;服务器接受请求并返回HTTP响应-&gt;释放连接TCP连接-&gt;客户端浏览器解析HTML内容</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;状态码分类-HTTP-Status-Code&quot;&gt;&lt;a href=&quot;#状态码分类-HTTP-Status-Code&quot; class=&quot;headerlink&quot; title=&quot;状态码分类(HTTP Status Code)&quot;&gt;&lt;/a&gt;状态码分类(HTTP Status Code)&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1XX- 信息型，服务器收到请求，需要请求者继续操作。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2XX- 成功型，请求成功收到，理解并处理。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3XX - 重定向，需要进一步的操作以完成请求。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4XX - 客户端错误，请求包含语法错误或无法完成请求。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5XX - 服务器错误，服务器在处理请求的过程中发生了错误。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="协议" scheme="https://wzh3683.github.io/hexo_blog/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>&#39;HTTP协议和HTTPS协议&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/08/HTTP%E5%8D%8F%E8%AE%AE%E5%92%8CHTTPS%E5%8D%8F%E8%AE%AE/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/08/HTTP%E5%8D%8F%E8%AE%AE%E5%92%8CHTTPS%E5%8D%8F%E8%AE%AE/</id>
    <published>2020-06-08T09:21:21.000Z</published>
    <updated>2020-06-20T10:20:28.771Z</updated>
    
    <content type="html"><![CDATA[<h3 id="HTTP协议和HTTPS协议的概念"><a href="#HTTP协议和HTTPS协议的概念" class="headerlink" title="HTTP协议和HTTPS协议的概念"></a>HTTP协议和HTTPS协议的概念</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP协议(Hyper Text Transfer Protocol)：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），</span><br><span class="line">    用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。</span><br><span class="line">HTTPS协议：是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，</span><br><span class="line">    HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。</span><br><span class="line">HTTPS协议的主要作用可以分为两种：</span><br><span class="line">    1.一种是建立一个信息安全通道，来保证数据传输的安全；</span><br><span class="line">    2.另一种就是确认网站的真实性。</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="HTTP协议的缺点"><a href="#HTTP协议的缺点" class="headerlink" title="HTTP协议的缺点"></a>HTTP协议的缺点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP缺点：</span><br><span class="line">    1.通信使用明文，内容可能被窃听(重要密码泄露)</span><br><span class="line">    2.不验证通信方身份，有可能遭遇伪装(跨站点请求伪造)</span><br><span class="line">    3.无法证明报文的完整性，有可能已遭篡改(运营商劫持)</span><br></pre></td></tr></table></figure><h3 id="http和https的区别与联系及特点"><a href="#http和https的区别与联系及特点" class="headerlink" title="http和https的区别与联系及特点"></a>http和https的区别与联系及特点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    HTTP协议是超文本传输协议，被用于在Web浏览器和网站服务器之间传递信息的，</span><br><span class="line">是一个基于请求与响应，无状态的，应用层的协议，是TCP&#x2F;IP协议传输数据，HTTP协议以明文方式发送内容，</span><br><span class="line">不提供任何方式的数据加密，如果攻击者截取了Web浏览器和网站服务器之间的传输报文，</span><br><span class="line">就可以直接读懂其中的信息，因此，HTTP协议不适合传输一些敏感信息，比如：信用卡号、密码等支付信息。</span><br><span class="line"></span><br><span class="line">    为了解决HTTP协议的这一缺陷，需要使用另一种协议：安全套接字层超文本传输协议HTTPS，</span><br><span class="line">为了数据传输的安全，HTTPS在HTTP的基础上加入了SSL协议，</span><br><span class="line">SSL依靠证书来验证服务器的身份，并为浏览器和服务器之间的通信加密。</span><br><span class="line"></span><br><span class="line">无状态：协议对客户端没有状态存储，对事物处理没有“记忆”能力，比如访问一个网站需要反复进行登录操作</span><br><span class="line">无连接：每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。</span><br><span class="line">SSL：网景公司设计了SSL（SecureSocketsLayer）协议用于对HTTP协议传输的数据进行加密，从而就诞生了HTTPS。</span><br></pre></td></tr></table></figure><h3 id="HTTPS和HTTP的区别主要如下："><a href="#HTTPS和HTTP的区别主要如下：" class="headerlink" title="HTTPS和HTTP的区别主要如下："></a>HTTPS和HTTP的区别主要如下：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。</span><br><span class="line">2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl（安全套接字层SSL）加密传输协议。</span><br><span class="line">3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</span><br><span class="line">4、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。</span><br><span class="line">5、https相对于http协议的连接方式来讲，性能方面会有所损耗。</span><br></pre></td></tr></table></figure><h3 id="HTTPS的工作流程"><a href="#HTTPS的工作流程" class="headerlink" title="HTTPS的工作流程"></a>HTTPS的工作流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第一步：客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。</span><br><span class="line">第二步：Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。</span><br><span class="line">第三步：客户端的浏览器与Web服务器开始协商SSL连接的安全等级，也就是信息加密的等级。</span><br><span class="line">第四步：客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。</span><br><span class="line">第五步：Web服务器利用自己的私钥解密出会话密钥。</span><br><span class="line">第六步：Web服务器利用会话密钥加密与客户端之间的通信。</span><br></pre></td></tr></table></figure><h3 id="HTTPS的优缺点"><a href="#HTTPS的优缺点" class="headerlink" title="HTTPS的优缺点"></a>HTTPS的优缺点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">优点：</span><br><span class="line">    <span class="number">1.</span>SEO方面：谷歌曾在<span class="number">2014</span>年<span class="number">8</span>月份调整搜索引擎算法，并称“比起同等HTTP网站，采用HTTPS加密的网站在搜索结果中的排名将会更高”。</span><br><span class="line">    <span class="number">2.</span>安全性：</span><br><span class="line">        （<span class="number">1</span>）、使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；</span><br><span class="line">        （<span class="number">2</span>）、HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，</span><br><span class="line">        要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。</span><br><span class="line">        （<span class="number">3</span>）、HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">    <span class="number">1.</span>SEO方面：</span><br><span class="line">        （<span class="number">1</span>）使用HTTPS协议会使页面的加载时间延长近<span class="number">50</span>%，增加<span class="number">10</span>%到<span class="number">20</span>%的耗电</span><br><span class="line">        （<span class="number">2</span>）HTTPS协议还会影响缓存，增加数据开销和功耗，甚至已有安全措施也会受到影响也会因此而受到影响。</span><br><span class="line">        （<span class="number">3</span>）HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。</span><br><span class="line">        （<span class="number">4</span>）成本增加。</span><br><span class="line">    <span class="number">2.</span>经济方面：</span><br><span class="line">        (<span class="number">1</span>)SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。</span><br><span class="line">        (<span class="number">2</span>)HTTPS连接缓存不如HTTP高效，大流量网站如非必要也不会采</span><br><span class="line">        (<span class="number">3</span>)HTTPS协议握手阶段比较费时，对网站的相应速度有负面影响</span><br></pre></td></tr></table></figure><h3 id="免费HTTPS证书推荐-排名不分先后"><a href="#免费HTTPS证书推荐-排名不分先后" class="headerlink" title="免费HTTPS证书推荐(排名不分先后)"></a>免费HTTPS证书推荐(排名不分先后)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SSL 证书级别分为三种类型，域名型SSL证书（DV SSL）、企业型SSL证书（OVSSL）、增强型SSL证书（EVSSL）</span><br><span class="line">(<span class="number">1</span>).Let<span class="string">'s Encrypt </span></span><br><span class="line"><span class="string">(2).startSSL</span></span><br><span class="line"><span class="string">(3).Wosign沃通SSL</span></span><br><span class="line"><span class="string">(4).NameCheap   </span></span><br><span class="line"><span class="string">(5).腾讯云DV SSL 证书</span></span><br><span class="line"><span class="string">(6).阿里云DV SSL证书</span></span><br><span class="line"><span class="string">(7).360网站卫士、百度云加速免费SSL、又拍云、七牛云</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;HTTP协议和HTTPS协议的概念&quot;&gt;&lt;a href=&quot;#HTTP协议和HTTPS协议的概念&quot; class=&quot;headerlink&quot; title=&quot;HTTP协议和HTTPS协议的概念&quot;&gt;&lt;/a&gt;HTTP协议和HTTPS协议的概念&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HTTP协议(Hyper Text Transfer Protocol)：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HTTPS协议：是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HTTPS协议的主要作用可以分为两种：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1.一种是建立一个信息安全通道，来保证数据传输的安全；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    2.另一种就是确认网站的真实性。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="协议" scheme="https://wzh3683.github.io/hexo_blog/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>&#39;结合百度ai实现自然语言分析&#39;</title>
    <link href="https://wzh3683.github.io/hexo_blog/2020/06/07/%E7%BB%93%E5%90%88%E7%99%BE%E5%BA%A6AI%E5%AE%9E%E7%8E%B0%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%88%86%E6%9E%90/"/>
    <id>https://wzh3683.github.io/hexo_blog/2020/06/07/%E7%BB%93%E5%90%88%E7%99%BE%E5%BA%A6AI%E5%AE%9E%E7%8E%B0%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%88%86%E6%9E%90/</id>
    <published>2020-06-07T13:25:36.000Z</published>
    <updated>2020-06-20T10:28:58.828Z</updated>
    
    <content type="html"><![CDATA[<p>百度AI开放平台地址：<a href="https://ai.baidu.com/" target="_blank" rel="noopener">点击跳转</a><br>官方文档地址：<a href="https://ai.baidu.com/tech/nlp_apply/sentiment_classify" target="_blank" rel="noopener">点击跳转</a></p><a id="more"></a><h3 id="获取应用"><a href="#获取应用" class="headerlink" title="获取应用"></a>获取应用</h3><p>1.进行注册登陆<br>2.找到文字识别–&gt;应用列表<br>3.创建应用<br>4.获取AppID,API Key,Secret Key<br><img src="/img/python/%E7%99%BE%E5%BA%A6AI%E5%BA%94%E7%94%A8.png" alt="获取应用"></p><p>安装百度AI模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install baidu-aip</span><br></pre></td></tr></table></figure><h3 id="对文本进行错误检查"><a href="#对文本进行错误检查" class="headerlink" title="对文本进行错误检查"></a>对文本进行错误检查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> aip <span class="keyword">import</span> AipNlp</span><br><span class="line"></span><br><span class="line">appip = <span class="string">'your appid'</span></span><br><span class="line">appkey = <span class="string">'your appkey'</span></span><br><span class="line">secret_key = <span class="string">'your secret_key'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例化对象</span></span><br><span class="line">client = AipNlp(appip,appkey,secret_key)</span><br><span class="line"><span class="comment">#定义检查文本</span></span><br><span class="line">text = <span class="string">'学习python，学习人工只能'</span></span><br><span class="line"><span class="comment">#进行检查</span></span><br><span class="line">res = client.ecnet(text)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;'log_id': 9052624029983259239, 'item': &#123;'vec_fragment': [&#123;'ori_frag': '人工只能', 'begin_pos': 16, 'correct_frag': '人工智能', 'end_pos': 24&#125;], 'score': 0.590899, 'correct_query': '学习python，学习人工智能'&#125;, 'text': '学习python，学习人工只能'&#125;</span></span><br></pre></td></tr></table></figure><h3 id="对文本进行标签处理"><a href="#对文本进行标签处理" class="headerlink" title="对文本进行标签处理"></a>对文本进行标签处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> aip <span class="keyword">import</span> AipNlp</span><br><span class="line"></span><br><span class="line">appip = <span class="string">'your appid'</span></span><br><span class="line">appkey = <span class="string">'your appkey'</span></span><br><span class="line">secret_key = <span class="string">'your secret_key'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例化对象</span></span><br><span class="line">client = AipNlp(appip,appkey,secret_key)</span><br><span class="line"><span class="comment">#标签</span></span><br><span class="line">title = <span class="string">'python人工智能在线学习'</span></span><br><span class="line">content = <span class="string">'我再北京学习人工智能，他是基于python的一门学科'</span></span><br><span class="line"><span class="comment">#调取标签</span></span><br><span class="line">res = client.keyword(title,content)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;'log_id': 2174377746871861863, 'items': [&#123;'score': 0.9486, 'tag': '人工智能'&#125;, &#123;'score': 0.768706, 'tag': 'python'&#125;]&#125;</span></span><br></pre></td></tr></table></figure><h3 id="对文本进行情感分析"><a href="#对文本进行情感分析" class="headerlink" title="对文本进行情感分析"></a>对文本进行情感分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> aip <span class="keyword">import</span> AipNlp</span><br><span class="line"></span><br><span class="line">appip = <span class="string">'your appid'</span></span><br><span class="line">appkey = <span class="string">'your appkey'</span></span><br><span class="line">secret_key = <span class="string">'your secret_key'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例化对象</span></span><br><span class="line">client = AipNlp(appip,appkey,secret_key)</span><br><span class="line"><span class="comment">#情感分析</span></span><br><span class="line">text = <span class="string">'华为是一家很棒的公司'</span></span><br><span class="line">print(client.commentTag(text))</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;'log_id': 1058331879559622439, 'items': [&#123;'sentiment': 2, 'abstract': '华为是一家很棒的公司&lt;span&gt;&lt;/span&gt;', 'prop': '感觉', 'begin_pos': 20, 'end_pos': 20, 'adj': '棒'&#125;]&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;百度AI开放平台地址：&lt;a href=&quot;https://ai.baidu.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;点击跳转&lt;/a&gt;&lt;br&gt;官方文档地址：&lt;a href=&quot;https://ai.baidu.com/tech/nlp_apply/sentiment_classify&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;点击跳转&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/categories/python/"/>
    
    
      <category term="python" scheme="https://wzh3683.github.io/hexo_blog/tags/python/"/>
    
      <category term="django" scheme="https://wzh3683.github.io/hexo_blog/tags/django/"/>
    
  </entry>
  
</feed>
